# Smart Appliance Monitor - Energy Dashboard
# Version: 2.0.0 - Complete Redesign
# Ultra-organized dashboard with 9 views for comprehensive energy monitoring

title: Energy (SAM)
icon: mdi:lightning-bolt
path: sam-energy

views:
  # ============================================
  # VUE 1: HOME - VUE D'ENSEMBLE
  # ============================================
  - title: Vue d'Ensemble
    path: home
    icon: mdi:home-lightning-bolt
    cards:
      # En-tête principal
      - type: markdown
        content: |
          # ⚡ Smart Appliance Monitor
          **Dashboard Énergie Complet** - Surveillance avancée de 9 appareils

      # Métriques totales
      - type: horizontal-stack
        cards:
          - type: custom:mushroom-template-card
            primary: Appareils Actifs
            secondary: |
              {% set active = namespace(count=0) %}
              {% set entities = [
                'sensor.lave_linge_state',
                'sensor.lave_vaisselle_state',
                'sensor.chauffe_eau_state',
                'sensor.four_state',
                'sensor.seche_linge_state',
                'sensor.bambulab_x1c_state',
                'sensor.ecran_pc_state',
                'sensor.bureau_pc_state',
                'sensor.vmc_state'
              ] %}
              {% for entity in entities %}
                {% if is_state(entity, 'running') %}
                  {% set active.count = active.count + 1 %}
                {% endif %}
              {% endfor %}
              {{ active.count }} en cours
            icon: mdi:devices
            icon_color: blue

          - type: custom:mushroom-template-card
            primary: Coût Aujourd'hui
            secondary: |
              {% set total = (
                states('sensor.lave_linge_daily_cost') | float(0) +
                states('sensor.lave_vaisselle_daily_cost') | float(0) +
                states('sensor.chauffe_eau_daily_cost') | float(0) +
                states('sensor.four_daily_cost') | float(0) +
                states('sensor.seche_linge_daily_cost') | float(0) +
                states('sensor.bambulab_x1c_daily_cost') | float(0) +
                states('sensor.ecran_pc_daily_cost') | float(0) +
                states('sensor.bureau_pc_daily_cost') | float(0) +
                states('sensor.vmc_daily_cost') | float(0)
              ) | round(2) %}
              {{ total }} €
            icon: mdi:currency-eur
            icon_color: green

          - type: custom:mushroom-template-card
            primary: Coût Mensuel
            secondary: |
              {% set total = (
                states('sensor.lave_linge_monthly_cost') | float(0) +
                states('sensor.lave_vaisselle_monthly_cost') | float(0) +
                states('sensor.chauffe_eau_monthly_cost') | float(0) +
                states('sensor.four_monthly_cost') | float(0) +
                states('sensor.seche_linge_monthly_cost') | float(0) +
                states('sensor.bambulab_x1c_monthly_cost') | float(0) +
                states('sensor.ecran_pc_monthly_cost') | float(0) +
                states('sensor.bureau_pc_monthly_cost') | float(0) +
                states('sensor.vmc_monthly_cost') | float(0)
              ) | round(2) %}
              {{ total }} €
            icon: mdi:calendar-month
            icon_color: amber

      # Bouton Sync Energy Dashboard
      - type: button
        name: Synchroniser Energy Dashboard
        icon: mdi:sync
        tap_action:
          action: call-service
          service: smart_appliance_monitor.sync_with_energy_dashboard

      # Grid des 9 appareils - Cartes compactes
      - type: vertical-stack
        cards:
          - type: markdown
            content: "## 📊 Appareils Surveillés"
          
          # Ligne 1: Lave-Linge, Lave-Vaisselle, Sèche-Linge
          - type: horizontal-stack
            cards:
              - type: custom:mushroom-template-card
                primary: Lave-Linge
                secondary: |
                  {% set state = states('sensor.lave_linge_state') %}
                  {% if state == 'running' %}
                    🔵 {{ states('sensor.lave_linge_cycle_duration') }} min
                  {% elif state == 'finished' %}
                    ✅ Terminé
                  {% else %}
                    ⚪ Prêt
                  {% endif %}
                icon: mdi:washing-machine
                icon_color: |
                  {% if is_state('sensor.lave_linge_state', 'running') %}
                    blue
                  {% elif is_state('sensor.lave_linge_state', 'finished') %}
                    green
                  {% else %}
                    grey
                  {% endif %}
                tap_action:
                  action: navigate
                  navigation_path: /lovelace/lave_linge

              - type: custom:mushroom-template-card
                primary: Lave-Vaisselle
                secondary: |
                  {% set state = states('sensor.lave_vaisselle_state') %}
                  {% if state == 'running' %}
                    🔵 {{ states('sensor.lave_vaisselle_cycle_duration') }} min
                  {% elif state == 'finished' %}
                    ✅ Terminé
                  {% else %}
                    ⚪ Prêt
                  {% endif %}
                icon: mdi:dishwasher
                icon_color: |
                  {% if is_state('sensor.lave_vaisselle_state', 'running') %}
                    blue
                  {% elif is_state('sensor.lave_vaisselle_state', 'finished') %}
                    green
                  {% else %}
                    grey
                  {% endif %}
                tap_action:
                  action: navigate
                  navigation_path: /lovelace/lave_vaisselle

              - type: custom:mushroom-template-card
                primary: Sèche-Linge
                secondary: |
                  {% set state = states('sensor.seche_linge_state') %}
                  {% if state == 'running' %}
                    🔵 {{ states('sensor.seche_linge_cycle_duration') }} min
                  {% elif state == 'finished' %}
                    ✅ Terminé
                  {% else %}
                    ⚪ Prêt
                  {% endif %}
                icon: mdi:tumble-dryer
                icon_color: |
                  {% if is_state('sensor.seche_linge_state', 'running') %}
                    blue
                  {% elif is_state('sensor.seche_linge_state', 'finished') %}
                    green
                  {% else %}
                    grey
                  {% endif %}
                tap_action:
                  action: navigate
                  navigation_path: /lovelace/seche_linge

          # Ligne 2: Chauffe-Eau, Four, Imprimante 3D
          - type: horizontal-stack
            cards:
              - type: custom:mushroom-template-card
                primary: Chauffe-Eau
                secondary: |
                  {% if is_state('sensor.chauffe_eau_state', 'running') %}
                    🔵 Chauffe
                  {% else %}
                    ⚪ Inactif
                  {% endif %}
                icon: mdi:water-boiler
                icon_color: |
                  {% if is_state('sensor.chauffe_eau_state', 'running') %}
                    blue
                  {% else %}
                    grey
                  {% endif %}
                tap_action:
                  action: navigate
                  navigation_path: /lovelace/chauffe_eau

              - type: custom:mushroom-template-card
                primary: Four
                secondary: |
                  {% if is_state('sensor.four_state', 'running') %}
                    🔵 Cuisson
                  {% else %}
                    ⚪ Éteint
                  {% endif %}
                icon: mdi:stove
                icon_color: |
                  {% if is_state('sensor.four_state', 'running') %}
                    blue
                  {% else %}
                    grey
                  {% endif %}
                tap_action:
                  action: navigate
                  navigation_path: /lovelace/four

              - type: custom:mushroom-template-card
                primary: Bambulab X1C
                secondary: |
                  {% if is_state('sensor.bambulab_x1c_state', 'running') %}
                    🔵 Impression
                  {% else %}
                    ⚪ Prêt
                  {% endif %}
                icon: mdi:printer-3d
                icon_color: |
                  {% if is_state('sensor.bambulab_x1c_state', 'running') %}
                    blue
                  {% else %}
                    grey
                  {% endif %}
                tap_action:
                  action: navigate
                  navigation_path: /lovelace/bambulab_x1c

          # Ligne 3: Écran PC, PC Bureau, VMC
          - type: horizontal-stack
            cards:
              - type: custom:mushroom-template-card
                primary: Écran PC
                secondary: |
                  {% if is_state('sensor.ecran_pc_state', 'running') %}
                    🔵 Allumé
                  {% else %}
                    ⚪ Éteint
                  {% endif %}
                icon: mdi:monitor
                icon_color: |
                  {% if is_state('sensor.ecran_pc_state', 'running') %}
                    blue
                  {% else %}
                    grey
                  {% endif %}
                tap_action:
                  action: navigate
                  navigation_path: /lovelace/ecran_pc

              - type: custom:mushroom-template-card
                primary: PC Bureau
                secondary: |
                  {% if is_state('sensor.bureau_pc_state', 'running') %}
                    🔵 Allumé
                  {% else %}
                    ⚪ Éteint
                  {% endif %}
                icon: mdi:desktop-tower
                icon_color: |
                  {% if is_state('sensor.bureau_pc_state', 'running') %}
                    blue
                  {% else %}
                    grey
                  {% endif %}
                tap_action:
                  action: navigate
                  navigation_path: /lovelace/bureau_pc

              - type: custom:mushroom-template-card
                primary: VMC
                secondary: |
                  {% if is_state('sensor.vmc_state', 'running') %}
                    🔵 Boost
                  {% else %}
                    ⚪ Normal
                  {% endif %}
                icon: mdi:fan
                icon_color: |
                  {% if is_state('sensor.vmc_state', 'running') %}
                    blue
                  {% else %}
                    grey
                  {% endif %}
                tap_action:
                  action: navigate
                  navigation_path: /lovelace/vmc

      # Top Consommateurs du Jour
      - type: vertical-stack
        cards:
          - type: markdown
            content: "## 🏆 Top Consommateurs (Aujourd'hui)"
          
          - type: entities
            entities:
              - entity: sensor.chauffe_eau_daily_energy
                name: Chauffe-Eau
                icon: mdi:water-boiler
              - entity: sensor.lave_linge_daily_energy
                name: Lave-Linge
                icon: mdi:washing-machine
              - entity: sensor.four_daily_energy
                name: Four
                icon: mdi:stove
              - entity: sensor.lave_vaisselle_daily_energy
                name: Lave-Vaisselle
                icon: mdi:dishwasher
              - entity: sensor.seche_linge_daily_energy
                name: Sèche-Linge
                icon: mdi:tumble-dryer
              - entity: sensor.bambulab_x1c_daily_energy
                name: Imprimante 3D
                icon: mdi:printer-3d
              - entity: sensor.ecran_pc_daily_energy
                name: Écran PC
                icon: mdi:monitor
              - entity: sensor.bureau_pc_daily_energy
                name: PC Bureau
                icon: mdi:desktop-tower
              - entity: sensor.vmc_daily_energy
                name: VMC
                icon: mdi:fan
            state_color: true

      # Alertes Actives
      - type: vertical-stack
        cards:
          - type: markdown
            content: "## ⚠️ Alertes Actives"
          
          - type: custom:auto-entities
            card:
              type: entities
              title: Alertes de Durée
              state_color: true
            filter:
              include:
                - entity_id: binary_sensor.*_alert_duration
                  state: "on"
              exclude: []

          - type: custom:auto-entities
            card:
              type: entities
              title: Appareils Débranchés
              state_color: true
            filter:
              include:
                - entity_id: binary_sensor.*_unplugged
                  state: "on"
              exclude: []

          - type: custom:auto-entities
            card:
              type: entities
              title: Anomalies Détectées
              state_color: true
            filter:
              include:
                - entity_id: binary_sensor.*_anomaly_detected
                  state: "on"
              exclude: []

  # ============================================
  # VUE 2: MONITORING - ÉTAT DES APPAREILS
  # ============================================
  - title: Monitoring
    path: monitoring
    icon: mdi:monitor-dashboard
    cards:
      - type: markdown
        content: |
          ## 📺 Monitoring en Temps Réel

      # État de tous les appareils
      - type: entities
        title: État des Appareils
        state_color: true
        entities:
          - entity: sensor.lave_linge_state
            name: "🧺 Lave-Linge"
          - entity: sensor.lave_vaisselle_state
            name: "🍽️ Lave-Vaisselle"
          - entity: sensor.seche_linge_state
            name: "👕 Sèche-Linge"
          - entity: sensor.chauffe_eau_state
            name: "💧 Chauffe-Eau"
          - entity: sensor.four_state
            name: "🍕 Four"
          - entity: sensor.bambulab_x1c_state
            name: "🖨️ Imprimante 3D"
          - entity: sensor.ecran_pc_state
            name: "🖥️ Écran PC"
          - entity: sensor.bureau_pc_state
            name: "💻 PC Bureau"
          - entity: sensor.vmc_state
            name: "💨 VMC"

      # Cycles/Sessions en Cours
      - type: custom:auto-entities
        card:
          type: entities
          title: Cycles/Sessions Actifs
        filter:
          include:
            - entity_id: sensor.lave_linge_cycle_duration
              state: ">0"
              name: "🧺 Lave-Linge"
            - entity_id: sensor.lave_vaisselle_cycle_duration
              state: ">0"
              name: "🍽️ Lave-Vaisselle"
            - entity_id: sensor.seche_linge_cycle_duration
              state: ">0"
              name: "👕 Sèche-Linge"
            - entity_id: sensor.chauffe_eau_cycle_duration
              state: ">0"
              name: "💧 Chauffe-Eau"
            - entity_id: sensor.four_cycle_duration
              state: ">0"
              name: "🍕 Four"
            - entity_id: sensor.bambulab_x1c_cycle_duration
              state: ">0"
              name: "🖨️ Imprimante 3D"
          exclude:
            - state: "0"
            - state: "unavailable"

      # Graphique Multi-courbes des Puissances
      - type: custom:apexcharts-card
        header:
          show: true
          title: 📊 Puissances en Temps Réel (24h)
          show_states: true
        graph_span: 24h
        all_series_config:
          type: line
          stroke_width: 2
          curve: smooth
        series:
          - entity: sensor.lave_linge_power
            name: Lave-Linge
            color: '#3498db'
          - entity: sensor.lave_vaisselle_power
            name: Lave-Vaisselle
            color: '#16a085'
          - entity: sensor.seche_linge_power
            name: Sèche-Linge
            color: '#e67e22'
          - entity: sensor.chauffe_eau_power
            name: Chauffe-Eau
            color: '#f39c12'
          - entity: sensor.four_power
            name: Four
            color: '#9b59b6'
          - entity: sensor.bambulab_x1c_power
            name: Imprimante 3D
            color: '#e74c3c'

  # ============================================
  # VUE 3: DÉTAILS APPAREILS
  # ============================================
  - title: Détails Appareils
    path: details
    icon: mdi:information-variant
    cards:
      - type: markdown
        content: |
          ## 📋 Détails par Appareil
          Surveillance détaillée avec cartes custom

      # ========== LAVE-LINGE ==========
      - type: vertical-stack
        cards:
          - type: markdown
            content: "### 🧺 Lave-Linge"
          
          - type: custom:smart-appliance-cycle-card
            entity: sensor.lave_linge_state
            name: "Lave-Linge"
            icon: "mdi:washing-machine"
            show_power_graph: true
            show_action_buttons: true
            show_current_power: true
            graph_hours: 0.5
            theme: auto

          - type: custom:smart-appliance-stats-card
            entity: sensor.lave_linge_state
            name: "Statistiques Lave-Linge"
            default_tab: today
            show_trends: true
            show_efficiency: true
            theme: auto

      # ========== LAVE-VAISSELLE ==========
      - type: vertical-stack
        cards:
          - type: markdown
            content: "### 🍽️ Lave-Vaisselle"
          
          - type: custom:smart-appliance-cycle-card
            entity: sensor.lave_vaisselle_state
            name: "Lave-Vaisselle"
            icon: "mdi:dishwasher"
            show_power_graph: true
            show_action_buttons: true
            show_current_power: true
            graph_hours: 0.5
            theme: auto

          - type: custom:smart-appliance-stats-card
            entity: sensor.lave_vaisselle_state
            name: "Statistiques Lave-Vaisselle"
            default_tab: today
            show_trends: true
            show_efficiency: true
            theme: auto

      # ========== SÈCHE-LINGE ==========
      - type: vertical-stack
        cards:
          - type: markdown
            content: "### 👕 Sèche-Linge"
          
          - type: custom:smart-appliance-cycle-card
            entity: sensor.seche_linge_state
            name: "Sèche-Linge"
            icon: "mdi:tumble-dryer"
            show_power_graph: true
            show_action_buttons: true
            show_current_power: true
            graph_hours: 0.5
            theme: auto

          - type: custom:smart-appliance-stats-card
            entity: sensor.seche_linge_state
            name: "Statistiques Sèche-Linge"
            default_tab: today
            show_trends: true
            show_efficiency: true
            theme: auto

      # ========== CHAUFFE-EAU ==========
      - type: vertical-stack
        cards:
          - type: markdown
            content: "### 💧 Chauffe-Eau"
          
          - type: custom:smart-appliance-cycle-card
            entity: sensor.chauffe_eau_state
            name: "Chauffe-Eau"
            icon: "mdi:water-boiler"
            show_power_graph: true
            show_action_buttons: true
            show_current_power: true
            graph_hours: 1
            theme: auto

          - type: custom:smart-appliance-stats-card
            entity: sensor.chauffe_eau_state
            name: "Statistiques Chauffe-Eau"
            default_tab: today
            show_trends: true
            show_efficiency: true
            theme: auto

      # ========== FOUR ==========
      - type: vertical-stack
        cards:
          - type: markdown
            content: "### 🍕 Four"
          
          - type: custom:smart-appliance-cycle-card
            entity: sensor.four_state
            name: "Four"
            icon: "mdi:stove"
            show_power_graph: true
            show_action_buttons: true
            show_current_power: true
            graph_hours: 0.5
            theme: auto

          - type: custom:smart-appliance-stats-card
            entity: sensor.four_state
            name: "Statistiques Four"
            default_tab: today
            show_trends: true
            show_efficiency: true
            theme: auto

      # ========== IMPRIMANTE 3D ==========
      - type: vertical-stack
        cards:
          - type: markdown
            content: "### 🖨️ Imprimante 3D (Bambulab X1C)"
          
          - type: custom:smart-appliance-cycle-card
            entity: sensor.bambulab_x1c_state
            name: "Bambulab X1C"
            icon: "mdi:printer-3d"
            show_power_graph: true
            show_action_buttons: true
            show_current_power: true
            graph_hours: 2
            theme: auto

          - type: custom:smart-appliance-stats-card
            entity: sensor.bambulab_x1c_state
            name: "Statistiques Imprimante 3D"
            default_tab: today
            show_trends: true
            show_efficiency: true
            theme: auto

      # ========== ÉCRAN PC ==========
      - type: vertical-stack
        cards:
          - type: markdown
            content: "### 🖥️ Écran PC"
          
          - type: custom:smart-appliance-cycle-card
            entity: sensor.ecran_pc_state
            name: "Écran PC"
            icon: "mdi:monitor"
            show_power_graph: true
            show_action_buttons: true
            show_current_power: true
            graph_hours: 1
            theme: auto

          - type: custom:smart-appliance-stats-card
            entity: sensor.ecran_pc_state
            name: "Statistiques Écran PC"
            default_tab: today
            show_trends: true
            show_efficiency: true
            theme: auto

      # ========== PC BUREAU ==========
      - type: vertical-stack
        cards:
          - type: markdown
            content: "### 💻 PC Bureau"
          
          - type: custom:smart-appliance-cycle-card
            entity: sensor.bureau_pc_state
            name: "PC Bureau"
            icon: "mdi:desktop-tower"
            show_power_graph: true
            show_action_buttons: true
            show_current_power: true
            graph_hours: 1
            theme: auto

          - type: custom:smart-appliance-stats-card
            entity: sensor.bureau_pc_state
            name: "Statistiques PC Bureau"
            default_tab: today
            show_trends: true
            show_efficiency: true
            theme: auto

      # ========== VMC ==========
      - type: vertical-stack
        cards:
          - type: markdown
            content: "### 💨 VMC"
          
          - type: custom:smart-appliance-cycle-card
            entity: sensor.vmc_state
            name: "VMC"
            icon: "mdi:fan"
            show_power_graph: true
            show_action_buttons: true
            show_current_power: true
            graph_hours: 0.5
            theme: auto

          - type: custom:smart-appliance-stats-card
            entity: sensor.vmc_state
            name: "Statistiques VMC"
            default_tab: today
            show_trends: true
            show_efficiency: true
            theme: auto

  # ============================================
  # VUE 4: ÉNERGIE & COÛTS
  # ============================================
  - title: Énergie & Coûts
    path: energy
    icon: mdi:currency-eur
    cards:
      - type: markdown
        content: |
          ## 💰 Énergie & Coûts
          Analyse détaillée de la consommation et des dépenses

      # Bouton Sync Energy Dashboard
      - type: button
        name: Synchroniser Energy Dashboard
        icon: mdi:sync
        tap_action:
          action: call-service
          service: smart_appliance_monitor.sync_with_energy_dashboard

      # Consommation par Appareil - Graphiques Comparatifs
      - type: vertical-stack
        cards:
          - type: markdown
            content: "### 📊 Consommation par Appareil"
          
          - type: custom:apexcharts-card
            header:
              show: true
              title: Consommation Journalière (7 derniers jours)
              show_states: true
            graph_span: 7d
            span:
              end: day
            all_series_config:
              type: column
              stroke_width: 0
              group_by:
                func: sum
                duration: 1d
            series:
              - entity: sensor.lave_linge_daily_energy
                name: Lave-Linge
                color: '#3498db'
              - entity: sensor.lave_vaisselle_daily_energy
                name: Lave-Vaisselle
                color: '#16a085'
              - entity: sensor.seche_linge_daily_energy
                name: Sèche-Linge
                color: '#e67e22'
              - entity: sensor.chauffe_eau_daily_energy
                name: Chauffe-Eau
                color: '#f39c12'
              - entity: sensor.four_daily_energy
                name: Four
                color: '#9b59b6'
              - entity: sensor.bambulab_x1c_daily_energy
                name: Imprimante 3D
                color: '#e74c3c'
              - entity: sensor.ecran_pc_daily_energy
                name: Écran PC
                color: '#95a5a6'
              - entity: sensor.bureau_pc_daily_energy
                name: PC Bureau
                color: '#34495e'
              - entity: sensor.vmc_daily_energy
                name: VMC
                color: '#1abc9c'

      # Coûts Quotidiens - 7 jours
      - type: vertical-stack
        cards:
          - type: markdown
            content: "### 💸 Coûts Quotidiens (7 jours)"
          
          - type: custom:apexcharts-card
            header:
              show: true
              title: Coûts par Appareil (7j)
              show_states: true
            graph_span: 7d
            span:
              end: day
            all_series_config:
              type: line
              stroke_width: 2
              curve: smooth
              group_by:
                func: sum
                duration: 1d
            series:
              - entity: sensor.lave_linge_daily_cost
                name: Lave-Linge
                color: '#3498db'
              - entity: sensor.lave_vaisselle_daily_cost
                name: Lave-Vaisselle
                color: '#16a085'
              - entity: sensor.seche_linge_daily_cost
                name: Sèche-Linge
                color: '#e67e22'
              - entity: sensor.chauffe_eau_daily_cost
                name: Chauffe-Eau
                color: '#f39c12'
              - entity: sensor.four_daily_cost
                name: Four
                color: '#9b59b6'
              - entity: sensor.bambulab_x1c_daily_cost
                name: Imprimante 3D
                color: '#e74c3c'

      # Coûts Mensuels - 12 mois
      - type: vertical-stack
        cards:
          - type: markdown
            content: "### 📅 Coûts Mensuels (12 mois)"
          
          - type: custom:apexcharts-card
            header:
              show: true
              title: Évolution Mensuelle des Coûts
              show_states: true
            graph_span: 12month
            span:
              end: month
            all_series_config:
              type: column
              stroke_width: 0
              group_by:
                func: sum
                duration: 1month
            series:
              - entity: sensor.lave_linge_monthly_cost
                name: Lave-Linge
                color: '#3498db'
              - entity: sensor.lave_vaisselle_monthly_cost
                name: Lave-Vaisselle
                color: '#16a085'
              - entity: sensor.seche_linge_monthly_cost
                name: Sèche-Linge
                color: '#e67e22'
              - entity: sensor.chauffe_eau_monthly_cost
                name: Chauffe-Eau
                color: '#f39c12'
              - entity: sensor.four_monthly_cost
                name: Four
                color: '#9b59b6'
              - entity: sensor.bambulab_x1c_monthly_cost
                name: Imprimante 3D
                color: '#e74c3c'

      # Projections de Coût Mensuel
      - type: vertical-stack
        cards:
          - type: markdown
            content: "### 🔮 Projections Mensuelles"
          
          - type: horizontal-stack
            cards:
              - type: custom:mushroom-template-card
                primary: Total Actuel
                secondary: |
                  {% set total = (
                    states('sensor.lave_linge_monthly_cost') | float(0) +
                    states('sensor.lave_vaisselle_monthly_cost') | float(0) +
                    states('sensor.chauffe_eau_monthly_cost') | float(0) +
                    states('sensor.four_monthly_cost') | float(0) +
                    states('sensor.seche_linge_monthly_cost') | float(0) +
                    states('sensor.bambulab_x1c_monthly_cost') | float(0) +
                    states('sensor.ecran_pc_monthly_cost') | float(0) +
                    states('sensor.bureau_pc_monthly_cost') | float(0) +
                    states('sensor.vmc_monthly_cost') | float(0)
                  ) | round(2) %}
                  {{ total }} €
                icon: mdi:currency-eur
                icon_color: green

              - type: custom:mushroom-template-card
                primary: Projection Fin Mois
                secondary: |
                  {% set now = now() %}
                  {% set day_of_month = now.day %}
                  {% set days_in_month = (now.replace(day=1) + timedelta(days=32)).replace(day=1).replace(day=1) - timedelta(days=1) %}
                  {% set days_in_month_num = days_in_month.day %}
                  {% set total_current = (
                    states('sensor.lave_linge_monthly_cost') | float(0) +
                    states('sensor.lave_vaisselle_monthly_cost') | float(0) +
                    states('sensor.chauffe_eau_monthly_cost') | float(0) +
                    states('sensor.four_monthly_cost') | float(0) +
                    states('sensor.seche_linge_monthly_cost') | float(0) +
                    states('sensor.bambulab_x1c_monthly_cost') | float(0) +
                    states('sensor.ecran_pc_monthly_cost') | float(0) +
                    states('sensor.bureau_pc_monthly_cost') | float(0) +
                    states('sensor.vmc_monthly_cost') | float(0)
                  ) %}
                  {% set projection = (total_current / day_of_month * days_in_month_num) | round(2) %}
                  {{ projection }} €
                icon: mdi:crystal-ball
                icon_color: purple

      # Classement Consommateurs
      - type: vertical-stack
        cards:
          - type: markdown
            content: "### 🏆 Classement des Consommateurs (Ce Mois)"
          
          - type: custom:bar-card
            entities:
              - entity: sensor.chauffe_eau_monthly_cost
                name: Chauffe-Eau
                icon: mdi:water-boiler
              - entity: sensor.lave_linge_monthly_cost
                name: Lave-Linge
                icon: mdi:washing-machine
              - entity: sensor.four_monthly_cost
                name: Four
                icon: mdi:stove
              - entity: sensor.lave_vaisselle_monthly_cost
                name: Lave-Vaisselle
                icon: mdi:dishwasher
              - entity: sensor.seche_linge_monthly_cost
                name: Sèche-Linge
                icon: mdi:tumble-dryer
              - entity: sensor.bambulab_x1c_monthly_cost
                name: Imprimante 3D
                icon: mdi:printer-3d
              - entity: sensor.ecran_pc_monthly_cost
                name: Écran PC
                icon: mdi:monitor
              - entity: sensor.bureau_pc_monthly_cost
                name: PC Bureau
                icon: mdi:desktop-tower
              - entity: sensor.vmc_monthly_cost
                name: VMC
                icon: mdi:fan
            unit_of_measurement: €
            severity:
              - value: 0
                color: '#2ecc71'
              - value: 10
                color: '#f39c12'
              - value: 30
                color: '#e74c3c'
            positions:
              icon: outside
              name: inside
              value: inside

      # Budget Tracking
      - type: vertical-stack
        cards:
          - type: markdown
            content: "### 💳 Suivi de Budget"
          
          - type: horizontal-stack
            cards:
              - type: gauge
                entity: sensor.lave_linge_monthly_cost
                name: Lave-Linge
                min: 0
                max: 20
                unit: €
                needle: true
                severity:
                  green: 0
                  yellow: 12
                  red: 16

              - type: gauge
                entity: sensor.lave_vaisselle_monthly_cost
                name: Lave-Vaisselle
                min: 0
                max: 20
                unit: €
                needle: true
                severity:
                  green: 0
                  yellow: 12
                  red: 16

              - type: gauge
                entity: sensor.seche_linge_monthly_cost
                name: Sèche-Linge
                min: 0
                max: 30
                unit: €
                needle: true
                severity:
                  green: 0
                  yellow: 18
                  red: 24

          - type: horizontal-stack
            cards:
              - type: gauge
                entity: sensor.chauffe_eau_monthly_cost
                name: Chauffe-Eau
                min: 0
                max: 50
                unit: €
                needle: true
                severity:
                  green: 0
                  yellow: 30
                  red: 40

              - type: gauge
                entity: sensor.four_monthly_cost
                name: Four
                min: 0
                max: 15
                unit: €
                needle: true
                severity:
                  green: 0
                  yellow: 9
                  red: 12

              - type: gauge
                entity: sensor.bambulab_x1c_monthly_cost
                name: Imprimante 3D
                min: 0
                max: 30
                unit: €
                needle: true
                severity:
                  green: 0
                  yellow: 18
                  red: 24

  # ============================================
  # VUE 5: ANALYSE IA
  # ============================================
  - title: Analyse IA
    path: ai
    icon: mdi:robot
    cards:
      - type: markdown
        content: |
          ## 🤖 Analyse IA
          Analyse intelligente des cycles et recommandations d'économie

      # Configuration Globale
      - type: entities
        title: Configuration Globale IA
        entities:
          - entity: select.smart_appliance_monitor_ai_task
            name: Tâche IA
          - entity: select.smart_appliance_monitor_price_entity
            name: Entité Prix

      # Switches Activation IA par Appareil
      - type: vertical-stack
        cards:
          - type: markdown
            content: "### ⚙️ Activation IA par Appareil"
          
          - type: entities
            title: Analyse IA Automatique
            entities:
              - entity: switch.lave_linge_ai_analysis
                name: "🧺 Lave-Linge"
              - entity: switch.lave_vaisselle_ai_analysis
                name: "🍽️ Lave-Vaisselle"
              - entity: switch.seche_linge_ai_analysis
                name: "👕 Sèche-Linge"
              - entity: switch.chauffe_eau_ai_analysis
                name: "💧 Chauffe-Eau"
              - entity: switch.four_ai_analysis
                name: "🍕 Four"
              - entity: switch.bambulab_x1c_ai_analysis
                name: "🖨️ Imprimante 3D"
              - entity: switch.ecran_pc_ai_analysis
                name: "🖥️ Écran PC"
              - entity: switch.bureau_pc_ai_analysis
                name: "💻 PC Bureau"
              - entity: switch.vmc_ai_analysis
                name: "💨 VMC"

      # Boutons Analyse par Appareil
      - type: vertical-stack
        cards:
          - type: markdown
            content: "### 🔍 Analyses Manuelles"
          
          # Lave-Linge
          - type: horizontal-stack
            cards:
              - type: custom:mushroom-template-card
                primary: "🧺 Lave-Linge"
                icon: mdi:washing-machine
                icon_color: blue
                tap_action:
                  action: none
              - type: button
                name: Pattern
                icon: mdi:chart-timeline-variant
                tap_action:
                  action: call-service
                  service: smart_appliance_monitor.analyze_cycles
                  service_data:
                    entity_id: sensor.lave_linge_state
                    analysis_type: pattern
                    cycle_count: 10
              - type: button
                name: Recommandations
                icon: mdi:lightbulb-on
                tap_action:
                  action: call-service
                  service: smart_appliance_monitor.analyze_cycles
                  service_data:
                    entity_id: sensor.lave_linge_state
                    analysis_type: recommendations
                    cycle_count: 10
              - type: button
                name: Complète
                icon: mdi:chart-box
                tap_action:
                  action: call-service
                  service: smart_appliance_monitor.analyze_cycles
                  service_data:
                    entity_id: sensor.lave_linge_state
                    analysis_type: all
                    cycle_count: 10

          # Lave-Vaisselle
          - type: horizontal-stack
            cards:
              - type: custom:mushroom-template-card
                primary: "🍽️ Lave-Vaisselle"
                icon: mdi:dishwasher
                icon_color: teal
                tap_action:
                  action: none
              - type: button
                name: Pattern
                icon: mdi:chart-timeline-variant
                tap_action:
                  action: call-service
                  service: smart_appliance_monitor.analyze_cycles
                  service_data:
                    entity_id: sensor.lave_vaisselle_state
                    analysis_type: pattern
                    cycle_count: 10
              - type: button
                name: Recommandations
                icon: mdi:lightbulb-on
                tap_action:
                  action: call-service
                  service: smart_appliance_monitor.analyze_cycles
                  service_data:
                    entity_id: sensor.lave_vaisselle_state
                    analysis_type: recommendations
                    cycle_count: 10
              - type: button
                name: Complète
                icon: mdi:chart-box
                tap_action:
                  action: call-service
                  service: smart_appliance_monitor.analyze_cycles
                  service_data:
                    entity_id: sensor.lave_vaisselle_state
                    analysis_type: all
                    cycle_count: 10

      # Résultats d'Analyse avec Markdown
      - type: vertical-stack
        cards:
          - type: markdown
            content: "### 📊 Résultats d'Analyse"
          
          - type: markdown
            content: >
              #### 🧺 Lave-Linge

              **Résumé:** {{ state_attr('sensor.lave_linge_ai_analysis', 'summary') | default('Aucune analyse disponible', true) }}
              
              **Recommandations:** {{ state_attr('sensor.lave_linge_ai_analysis', 'recommendations') | default('N/A', true) }}

          - type: markdown
            content: >
              #### 🍽️ Lave-Vaisselle

              **Résumé:** {{ state_attr('sensor.lave_vaisselle_ai_analysis', 'summary') | default('Aucune analyse disponible', true) }}
              
              **Recommandations:** {{ state_attr('sensor.lave_vaisselle_ai_analysis', 'recommendations') | default('N/A', true) }}

      # Économies Potentielles
      - type: vertical-stack
        cards:
          - type: markdown
            content: "### 💡 Économies Potentielles"
          
          - type: horizontal-stack
            cards:
              - type: custom:mushroom-template-card
                primary: Lave-Linge
                secondary: "{{ state_attr('sensor.lave_linge_ai_analysis', 'energy_savings_kwh') | default('N/A', true) }} kWh | {{ state_attr('sensor.lave_linge_ai_analysis', 'energy_savings_eur') | default('N/A', true) }} €"
                icon: mdi:washing-machine
                icon_color: green
              
              - type: custom:mushroom-template-card
                primary: Lave-Vaisselle
                secondary: "{{ state_attr('sensor.lave_vaisselle_ai_analysis', 'energy_savings_kwh') | default('N/A', true) }} kWh | {{ state_attr('sensor.lave_vaisselle_ai_analysis', 'energy_savings_eur') | default('N/A', true) }} €"
                icon: mdi:dishwasher
                icon_color: green

  # ============================================
  # VUE 6: ALERTES & ANOMALIES
  # ============================================
  - title: Alertes & Anomalies
    path: alerts
    icon: mdi:alert-decagram
    cards:
      - type: markdown
        content: |
          ## ⚠️ Alertes & Anomalies
          Surveillance des alertes et détection d'anomalies

      # Alertes Actives
      - type: vertical-stack
        cards:
          - type: markdown
            content: "### 🚨 Alertes Actives"
          
          - type: custom:auto-entities
            card:
              type: entities
              title: Alertes Durée
              state_color: true
            filter:
              include:
                - entity_id: binary_sensor.*_alert_duration
                  state: "on"
              exclude: []
          
          - type: custom:auto-entities
            card:
              type: entities
              title: Appareils Débranchés
              state_color: true
            filter:
              include:
                - entity_id: binary_sensor.*_unplugged
                  state: "on"
              exclude: []
          
          - type: custom:auto-entities
            card:
              type: entities
              title: Dépassements Limites Énergie
              state_color: true
            filter:
              include:
                - entity_id: binary_sensor.*_energy_limit_exceeded
                  state: "on"
              exclude: []
          
          - type: custom:auto-entities
            card:
              type: entities
              title: Dépassements Budget
              state_color: true
            filter:
              include:
                - entity_id: binary_sensor.*_budget_exceeded
                  state: "on"
              exclude: []

      # Anomalies Détectées
      - type: vertical-stack
        cards:
          - type: markdown
            content: "### 🔍 Détection d'Anomalies"
          
          - type: custom:auto-entities
            card:
              type: entities
              title: Anomalies Actives
              state_color: true
            filter:
              include:
                - entity_id: binary_sensor.*_anomaly_detected
                  state: "on"
              exclude: []

      # Gauges Scores d'Anomalies
      - type: vertical-stack
        cards:
          - type: markdown
            content: "### 📊 Scores d'Anomalies"
          
          - type: horizontal-stack
            cards:
              - type: gauge
                entity: sensor.lave_linge_anomaly_score
                name: Lave-Linge
                min: 0
                max: 100
                needle: true
                severity:
                  green: 0
                  yellow: 30
                  red: 60
              
              - type: gauge
                entity: sensor.lave_vaisselle_anomaly_score
                name: Lave-Vaisselle
                min: 0
                max: 100
                needle: true
                severity:
                  green: 0
                  yellow: 30
                  red: 60
              
              - type: gauge
                entity: sensor.seche_linge_anomaly_score
                name: Sèche-Linge
                min: 0
                max: 100
                needle: true
                severity:
                  green: 0
                  yellow: 30
                  red: 60

          - type: horizontal-stack
            cards:
              - type: gauge
                entity: sensor.chauffe_eau_anomaly_score
                name: Chauffe-Eau
                min: 0
                max: 100
                needle: true
                severity:
                  green: 0
                  yellow: 30
                  red: 60
              
              - type: gauge
                entity: sensor.four_anomaly_score
                name: Four
                min: 0
                max: 100
                needle: true
                severity:
                  green: 0
                  yellow: 30
                  red: 60
              
              - type: gauge
                entity: sensor.bambulab_x1c_anomaly_score
                name: Imprimante 3D
                min: 0
                max: 100
                needle: true
                severity:
                  green: 0
                  yellow: 30
                  red: 60

      # Historique Scores (7j)
      - type: vertical-stack
        cards:
          - type: markdown
            content: "### 📈 Historique des Scores (7 jours)"
          
          - type: custom:apexcharts-card
            header:
              show: true
              title: Évolution Scores d'Anomalies
              show_states: true
            graph_span: 7d
            all_series_config:
              type: line
              stroke_width: 2
              curve: smooth
            series:
              - entity: sensor.lave_linge_anomaly_score
                name: Lave-Linge
                color: '#3498db'
              - entity: sensor.lave_vaisselle_anomaly_score
                name: Lave-Vaisselle
                color: '#16a085'
              - entity: sensor.seche_linge_anomaly_score
                name: Sèche-Linge
                color: '#e67e22'
              - entity: sensor.chauffe_eau_anomaly_score
                name: Chauffe-Eau
                color: '#f39c12'
              - entity: sensor.four_anomaly_score
                name: Four
                color: '#9b59b6'
              - entity: sensor.bambulab_x1c_anomaly_score
                name: Imprimante 3D
                color: '#e74c3c'

      # Usage Allowed (Scheduling)
      - type: vertical-stack
        cards:
          - type: markdown
            content: "### ⏰ Planification - Usage Autorisé"
          
          - type: entities
            title: État Planification
            entities:
              - entity: binary_sensor.lave_linge_usage_allowed
                name: "🧺 Lave-Linge"
              - entity: binary_sensor.lave_vaisselle_usage_allowed
                name: "🍽️ Lave-Vaisselle"
              - entity: binary_sensor.seche_linge_usage_allowed
                name: "👕 Sèche-Linge"
              - entity: binary_sensor.chauffe_eau_usage_allowed
                name: "💧 Chauffe-Eau"
              - entity: binary_sensor.four_usage_allowed
                name: "🍕 Four"

  # ============================================
  # VUE 7: GESTION ÉNERGÉTIQUE
  # ============================================
  - title: Gestion Énergie
    path: energy-management
    icon: mdi:cog
    cards:
      - type: markdown
        content: |
          ## ⚙️ Gestion Énergétique
          Configuration des limites, budgets et planifications

      # Energy Management Switches
      - type: vertical-stack
        cards:
          - type: markdown
            content: "### 🎛️ Limites Énergétiques"
          
          - type: entities
            title: Activation Limites par Appareil
            entities:
              - entity: switch.lave_linge_energy_limits
                name: "🧺 Lave-Linge"
              - entity: switch.lave_vaisselle_energy_limits
                name: "🍽️ Lave-Vaisselle"
              - entity: switch.seche_linge_energy_limits
                name: "👕 Sèche-Linge"
              - entity: switch.chauffe_eau_energy_limits
                name: "💧 Chauffe-Eau"
              - entity: switch.four_energy_limits
                name: "🍕 Four"
              - entity: switch.bambulab_x1c_energy_limits
                name: "🖨️ Imprimante 3D"

      # Gauges Consommation vs Limites
      - type: vertical-stack
        cards:
          - type: markdown
            content: "### 📊 Consommation vs Limites (Jour)"
          
          - type: horizontal-stack
            cards:
              - type: gauge
                entity: sensor.lave_linge_daily_energy
                name: Lave-Linge
                min: 0
                max: 3
                unit: kWh
                needle: true
                severity:
                  green: 0
                  yellow: 1.8
                  red: 2.4
              
              - type: gauge
                entity: sensor.lave_vaisselle_daily_energy
                name: Lave-Vaisselle
                min: 0
                max: 3
                unit: kWh
                needle: true
                severity:
                  green: 0
                  yellow: 1.8
                  red: 2.4
              
              - type: gauge
                entity: sensor.seche_linge_daily_energy
                name: Sèche-Linge
                min: 0
                max: 5
                unit: kWh
                needle: true
                severity:
                  green: 0
                  yellow: 3
                  red: 4

          - type: horizontal-stack
            cards:
              - type: gauge
                entity: sensor.chauffe_eau_daily_energy
                name: Chauffe-Eau
                min: 0
                max: 10
                unit: kWh
                needle: true
                severity:
                  green: 0
                  yellow: 6
                  red: 8
              
              - type: gauge
                entity: sensor.four_daily_energy
                name: Four
                min: 0
                max: 3
                unit: kWh
                needle: true
                severity:
                  green: 0
                  yellow: 1.8
                  red: 2.4
              
              - type: gauge
                entity: sensor.bambulab_x1c_daily_energy
                name: Imprimante 3D
                min: 0
                max: 5
                unit: kWh
                needle: true
                severity:
                  green: 0
                  yellow: 3
                  red: 4

      # Scheduling Configuration
      - type: vertical-stack
        cards:
          - type: markdown
            content: "### ⏰ Planification des Usages"
          
          - type: entities
            title: Activation Scheduling
            entities:
              - entity: switch.lave_linge_scheduling
                name: "🧺 Lave-Linge"
              - entity: switch.lave_vaisselle_scheduling
                name: "🍽️ Lave-Vaisselle"
              - entity: switch.seche_linge_scheduling
                name: "👕 Sèche-Linge"
              - entity: switch.chauffe_eau_scheduling
                name: "💧 Chauffe-Eau"
              - entity: switch.four_scheduling
                name: "🍕 Four"

      # Auto-Shutdown Switches
      - type: vertical-stack
        cards:
          - type: markdown
            content: "### 🔌 Arrêt Automatique"
          
          - type: entities
            title: Auto-Shutdown
            entities:
              - entity: switch.lave_linge_auto_shutdown
                name: "🧺 Lave-Linge"
              - entity: switch.lave_vaisselle_auto_shutdown
                name: "🍽️ Lave-Vaisselle"
              - entity: switch.seche_linge_auto_shutdown
                name: "👕 Sèche-Linge"
              - entity: switch.chauffe_eau_auto_shutdown
                name: "💧 Chauffe-Eau"

      # Tendances Mensuelles
      - type: vertical-stack
        cards:
          - type: markdown
            content: "### 📈 Tendances Mensuelles"
          
          - type: custom:apexcharts-card
            header:
              show: true
              title: Évolution Consommation Mensuelle
              show_states: true
            graph_span: 12month
            span:
              end: month
            all_series_config:
              type: area
              stroke_width: 2
              curve: smooth
              group_by:
                func: sum
                duration: 1month
            series:
              - entity: sensor.lave_linge_monthly_energy
                name: Lave-Linge
                color: '#3498db'
              - entity: sensor.lave_vaisselle_monthly_energy
                name: Lave-Vaisselle
                color: '#16a085'
              - entity: sensor.seche_linge_monthly_energy
                name: Sèche-Linge
                color: '#e67e22'
              - entity: sensor.chauffe_eau_monthly_energy
                name: Chauffe-Eau
                color: '#f39c12'

  # ============================================
  # VUE 8: CONTRÔLES GLOBAUX
  # ============================================
  - title: Contrôles Globaux
    path: controls
    icon: mdi:tune
    cards:
      - type: markdown
        content: |
          ## 🎚️ Contrôles Globaux
          Gestion centralisée de tous les appareils

      # Switches Monitoring
      - type: vertical-stack
        cards:
          - type: markdown
            content: "### 👁️ Surveillance Automatique"
          
          - type: entities
            title: Monitoring
            entities:
              - entity: switch.lave_linge_monitoring
                name: "🧺 Lave-Linge"
              - entity: switch.lave_vaisselle_monitoring
                name: "🍽️ Lave-Vaisselle"
              - entity: switch.seche_linge_monitoring
                name: "👕 Sèche-Linge"
              - entity: switch.chauffe_eau_monitoring
                name: "💧 Chauffe-Eau"
              - entity: switch.four_monitoring
                name: "🍕 Four"
              - entity: switch.bambulab_x1c_monitoring
                name: "🖨️ Imprimante 3D"
              - entity: switch.ecran_pc_monitoring
                name: "🖥️ Écran PC"
              - entity: switch.bureau_pc_monitoring
                name: "💻 PC Bureau"
              - entity: switch.vmc_monitoring
                name: "💨 VMC"

      # Switches Notifications Master
      - type: vertical-stack
        cards:
          - type: markdown
            content: "### 🔔 Notifications Principales"
          
          - type: entities
            title: Notifications Master
            entities:
              - entity: switch.lave_linge_notifications
                name: "🧺 Lave-Linge"
              - entity: switch.lave_vaisselle_notifications
                name: "🍽️ Lave-Vaisselle"
              - entity: switch.seche_linge_notifications
                name: "👕 Sèche-Linge"
              - entity: switch.chauffe_eau_notifications
                name: "💧 Chauffe-Eau"
              - entity: switch.four_notifications
                name: "🍕 Four"
              - entity: switch.bambulab_x1c_notifications
                name: "🖨️ Imprimante 3D"
              - entity: switch.ecran_pc_notifications
                name: "🖥️ Écran PC"
              - entity: switch.bureau_pc_notifications
                name: "💻 PC Bureau"
              - entity: switch.vmc_notifications
                name: "💨 VMC"

      # Notifications Détaillées par Type
      - type: vertical-stack
        cards:
          - type: markdown
            content: "### 📢 Notifications Détaillées"
          
          - type: entities
            title: Cycle Démarré
            entities:
              - entity: switch.lave_linge_notification_cycle_started
                name: "🧺 Lave-Linge"
              - entity: switch.lave_vaisselle_notification_cycle_started
                name: "🍽️ Lave-Vaisselle"
              - entity: switch.seche_linge_notification_cycle_started
                name: "👕 Sèche-Linge"
          
          - type: entities
            title: Cycle Terminé
            entities:
              - entity: switch.lave_linge_notification_cycle_finished
                name: "🧺 Lave-Linge"
              - entity: switch.lave_vaisselle_notification_cycle_finished
                name: "🍽️ Lave-Vaisselle"
              - entity: switch.seche_linge_notification_cycle_finished
                name: "👕 Sèche-Linge"
          
          - type: entities
            title: Alerte Durée
            entities:
              - entity: switch.lave_linge_notification_alert_duration
                name: "🧺 Lave-Linge"
              - entity: switch.lave_vaisselle_notification_alert_duration
                name: "🍽️ Lave-Vaisselle"
              - entity: switch.seche_linge_notification_alert_duration
                name: "👕 Sèche-Linge"
          
          - type: entities
            title: Appareil Débranché
            entities:
              - entity: switch.lave_linge_notification_unplugged
                name: "🧺 Lave-Linge"
              - entity: switch.lave_vaisselle_notification_unplugged
                name: "🍽️ Lave-Vaisselle"
              - entity: switch.seche_linge_notification_unplugged
                name: "👕 Sèche-Linge"

      # Boutons Reset Stats
      - type: vertical-stack
        cards:
          - type: markdown
            content: "### 🔄 Réinitialisation des Statistiques"
          
          - type: entities
            title: Reset Statistiques
            entities:
              - entity: button.lave_linge_reset_stats
                name: "🧺 Lave-Linge"
              - entity: button.lave_vaisselle_reset_stats
                name: "🍽️ Lave-Vaisselle"
              - entity: button.seche_linge_reset_stats
                name: "👕 Sèche-Linge"
              - entity: button.chauffe_eau_reset_stats
                name: "💧 Chauffe-Eau"
              - entity: button.four_reset_stats
                name: "🍕 Four"
              - entity: button.bambulab_x1c_reset_stats
                name: "🖨️ Imprimante 3D"
              - entity: button.ecran_pc_reset_stats
                name: "🖥️ Écran PC"
              - entity: button.bureau_pc_reset_stats
                name: "💻 PC Bureau"
              - entity: button.vmc_reset_stats
                name: "💨 VMC"

  # ============================================
  # VUE 9: EXPORT & SERVICES
  # ============================================
  - title: Export & Services
    path: export
    icon: mdi:download
    cards:
      - type: markdown
        content: |
          ## 📤 Export & Services
          Export de données et services avancés

      # Export CSV par Appareil
      - type: vertical-stack
        cards:
          - type: markdown
            content: "### 📄 Export CSV"
          
          - type: horizontal-stack
            cards:
              - type: button
                name: Lave-Linge
                icon: mdi:washing-machine
                tap_action:
                  action: call-service
                  service: smart_appliance_monitor.export_to_csv
                  service_data:
                    entity_id: sensor.lave_linge_state
              
              - type: button
                name: Lave-Vaisselle
                icon: mdi:dishwasher
                tap_action:
                  action: call-service
                  service: smart_appliance_monitor.export_to_csv
                  service_data:
                    entity_id: sensor.lave_vaisselle_state
              
              - type: button
                name: Sèche-Linge
                icon: mdi:tumble-dryer
                tap_action:
                  action: call-service
                  service: smart_appliance_monitor.export_to_csv
                  service_data:
                    entity_id: sensor.seche_linge_state

      # Export JSON par Appareil
      - type: vertical-stack
        cards:
          - type: markdown
            content: "### 📦 Export JSON"
          
          - type: horizontal-stack
            cards:
              - type: button
                name: Lave-Linge
                icon: mdi:washing-machine
                tap_action:
                  action: call-service
                  service: smart_appliance_monitor.export_to_json
                  service_data:
                    entity_id: sensor.lave_linge_state
              
              - type: button
                name: Lave-Vaisselle
                icon: mdi:dishwasher
                tap_action:
                  action: call-service
                  service: smart_appliance_monitor.export_to_json
                  service_data:
                    entity_id: sensor.lave_vaisselle_state
              
              - type: button
                name: Sèche-Linge
                icon: mdi:tumble-dryer
                tap_action:
                  action: call-service
                  service: smart_appliance_monitor.export_to_json
                  service_data:
                    entity_id: sensor.seche_linge_state

      # Services Avancés
      - type: vertical-stack
        cards:
          - type: markdown
            content: "### 🛠️ Services Avancés"
          
          - type: button
            name: Synchroniser Energy Dashboard
            icon: mdi:sync
            tap_action:
              action: call-service
              service: smart_appliance_monitor.sync_with_energy_dashboard
          
          - type: button
            name: Détecter Système Tarifaire
            icon: mdi:cash-check
            tap_action:
              action: call-service
              service: smart_appliance_monitor.detect_tariff_system
          
          - type: entities
            title: Données Énergie
            entities:
              - type: button
                name: Obtenir Données Jour
                icon: mdi:calendar-today
                tap_action:
                  action: call-service
                  service: smart_appliance_monitor.get_energy_data
                  service_data:
                    period: today
              
              - type: button
                name: Obtenir Données Mois
                icon: mdi:calendar-month
                tap_action:
                  action: call-service
                  service: smart_appliance_monitor.get_energy_data
                  service_data:
                    period: month

      # Historique Cycles
      - type: vertical-stack
        cards:
          - type: markdown
            content: "### 📜 Historique des Cycles"
          
          - type: markdown
            content: >
              Utilisez les services `get_cycle_history` pour consulter l'historique détaillé de chaque appareil.
              
              
              Exemple : 
              
              ```yaml
              
              service: smart_appliance_monitor.get_cycle_history
              
              data:
                entity_id: sensor.lave_linge_state
                days: 7
              ```

      # Analyse Energy Dashboard Globale
      - type: vertical-stack
        cards:
          - type: markdown
            content: "### 🔍 Analyse Energy Dashboard"
          
          - type: button
            name: Analyse Globale (7j)
            icon: mdi:chart-timeline-variant
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_energy_dashboard
              service_data:
                days: 7
          
          - type: button
            name: Analyse Globale (30j)
            icon: mdi:chart-line
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_energy_dashboard
              service_data:
                days: 30

