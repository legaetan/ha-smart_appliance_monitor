# Smart Appliance Monitor - Energy Dashboard
title: Energy (SAM)
icon: mdi:lightning-bolt
path: sam-energy

views:
  - title: Vue d'ensemble
    path: overview
    icon: mdi:home-lightning-bolt
    cards:
      # En-t√™te
      - type: markdown
        content: |
          # ‚ö° Tableau de Bord √ânergie
          **Smart Appliance Monitor** - Analyse √©nerg√©tique avanc√©e

      # R√©sum√© du jour
      - type: horizontal-stack
        cards:
          - type: custom:mushroom-template-card
            primary: √ânergie Totale
            secondary: "{{ states('sensor.index_edf_galinky') | float | round(1) }} kWh"
            icon: mdi:lightning-bolt
            icon_color: amber
            tap_action:
              action: navigate
              navigation_path: /energy
            card_mod:
              style: |
                ha-card {
                  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                  color: white;
                }

          - type: custom:mushroom-template-card
            primary: Co√ªt Estim√©
            secondary: "{{ (states('sensor.index_edf_galinky') | float * 0.1952) | round(2) }} ‚Ç¨"
            icon: mdi:currency-eur
            icon_color: pink
            tap_action:
              action: more-info

          - type: button
            name: Sync Energy Dashboard
            icon: mdi:sync
            tap_action:
              action: call-service
              service: smart_appliance_monitor.sync_with_energy_dashboard

      # Consommation par appareil SAM
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              ## üìä Consommation des Appareils Surveill√©s
          
          - type: custom:auto-entities
            card:
              type: entities
              title: √ânergie du Jour (kWh)
              state_color: true
            filter:
              include:
                - entity_id: sensor.chauffe_eau_daily_energy
                  name: "üíß Chauffe-eau"
                - entity_id: sensor.lave_linge_daily_energy
                  name: "üß∫ Lave-linge"
                - entity_id: sensor.four_daily_energy
                  name: "üçï Four"
                - entity_id: sensor.lave_vaisselle_daily_energy
                  name: "üçΩÔ∏è Lave-vaisselle"
                - entity_id: sensor.ecran_pc_daily_energy
                  name: "üñ•Ô∏è √âcran PC"
                - entity_id: sensor.bambulab_x1c_daily_energy
                  name: "üñ®Ô∏è Imprimante 3D"
                - entity_id: sensor.vmc_daily_energy
                  name: "üí® VMC"
                - entity_id: sensor.seche_linge_daily_energy
                  name: "üëï S√®che-linge"
                - entity_id: sensor.bureau_pc_daily_energy
                  name: "üíª PC Bureau"
            sort:
              method: state
              numeric: true
              reverse: true

      # Graphique des consommations
      - type: custom:apexcharts-card
        header:
          show: true
          title: üìà Consommation des 7 derniers jours
          show_states: true
          colorize_states: true
        graph_span: 7d
        span:
          end: day
        all_series_config:
          type: column
          group_by:
            func: last
            duration: 1d
        series:
          - entity: sensor.chauffe_eau_daily_energy
            name: Chauffe-eau
          - entity: sensor.lave_linge_daily_energy
            name: Lave-linge
          - entity: sensor.four_daily_energy
            name: Four
          - entity: sensor.lave_vaisselle_daily_energy
            name: Lave-vaisselle
          - entity: sensor.seche_linge_daily_energy
            name: S√®che-linge

      # Top consommateurs
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              ## üèÜ Top Consommateurs
          
          - type: custom:bar-card
            entities:
              - entity: sensor.chauffe_eau_daily_energy
                name: Chauffe-eau
                icon: mdi:water-boiler
              - entity: sensor.lave_linge_daily_energy
                name: Lave-linge
                icon: mdi:washing-machine
              - entity: sensor.four_daily_energy
                name: Four
                icon: mdi:stove
              - entity: sensor.lave_vaisselle_daily_energy
                name: Lave-vaisselle
                icon: mdi:dishwasher
              - entity: sensor.seche_linge_daily_energy
                name: S√®che-linge
                icon: mdi:tumble-dryer
            unit_of_measurement: kWh
            severity:
              - value: 0
                color: '#2ecc71'
              - value: 2
                color: '#f39c12'
              - value: 5
                color: '#e74c3c'
            max: 10
            positions:
              icon: outside
              name: inside
              value: inside

      # Actions rapides
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              ## ‚öôÔ∏è Actions Rapides
          
          - type: horizontal-stack
            cards:
              - type: button
                name: Synchroniser
                icon: mdi:sync
                tap_action:
                  action: call-service
                  service: smart_appliance_monitor.sync_with_energy_dashboard
              
              - type: button
                name: Exporter Donn√©es
                icon: mdi:download
                tap_action:
                  action: call-service
                  service: smart_appliance_monitor.get_energy_data
              
              - type: button
                name: Energy Dashboard HA
                icon: mdi:chart-line
                tap_action:
                  action: navigate
                  navigation_path: /energy

  # Vue d√©taill√©e par appareil
  - title: D√©tails Appareils
    path: details
    icon: mdi:devices
    cards:
      - type: vertical-stack
        cards:
          - type: custom:mushroom-template-card
            primary: Lave-Linge
            secondary: |
              {% set state = states('sensor.lave_linge_state') %}
              {% if state == 'running' %}
                üîµ Lavage en cours - {{ states('sensor.lave_linge_cycle_duration') }} min
              {% elif state == 'finished' %}
                ‚úÖ Lavage termin√© - {{ states('sensor.lave_linge_last_cycle_duration') }} min
              {% else %}
                ‚ö™ Pr√™t
              {% endif %}
            icon: mdi:washing-machine
            icon_color: |
              {% set state = states('sensor.lave_linge_state') %}
              {% if state == 'running' %}
                blue
              {% elif state == 'finished' %}
                green
              {% else %}
                grey
              {% endif %}
            badge_icon: |
              {% if is_state('binary_sensor.lave_linge_unplugged', 'on') %}
                mdi:power-plug-off
              {% endif %}
            badge_color: |
              {% if is_state('binary_sensor.lave_linge_unplugged', 'on') %}
                red
              {% endif %}
            tap_action:
              action: more-info
              entity: sensor.lave_linge_state
            fill_container: true
          - type: horizontal-stack
            cards:
              - type: gauge
                entity: sensor.lave_linge_cycle_duration
                name: Dur√©e cycle
                needle: true
                severity:
                  green: 0
                  yellow: 90
                  red: 150
                min: 0
                max: 180
                unit: min
              - type: entity
                entity: sensor.lave_linge_cycle_energy
                name: √ânergie cycle
                icon: mdi:lightning-bolt
              - type: entity
                entity: sensor.lave_linge_cycle_cost
                name: Co√ªt cycle
                icon: mdi:currency-eur
          - type: custom:mini-graph-card
            entities:
              - entity: sensor.lave_linge_puissance
                name: Puissance
                color: '#3498db'
            name: Consommation (24h)
            hours_to_show: 24
            points_per_hour: 4
            line_width: 2
            animate: true
            show:
              labels: true
              points: false
              legend: true
              fill: fade
            icon: mdi:chart-line
          - type: horizontal-stack
            cards:
              - type: entities
                title: Dernier cycle
                entities:
                  - sensor.lave_linge_last_cycle_duration
                  - sensor.lave_linge_last_cycle_energy
                  - sensor.lave_linge_last_cycle_cost
              - type: entities
                title: Aujourd'hui
                entities:
                  - sensor.lave_linge_daily_cycles
                  - sensor.lave_linge_daily_cost
              - type: entities
                title: Ce mois
                entities:
                  - sensor.lave_linge_monthly_cost
          - type: entities
            title: Contr√¥les
            entities:
              - entity: switch.lave_linge_monitoring
                name: Surveillance
                icon: mdi:eye
              - entity: switch.lave_linge_notifications
                name: Notifications
                icon: mdi:bell
              - type: divider
              - entity: switch.lave_linge_notification_cycle_started
                name: Notif. D√©marrage
              - entity: switch.lave_linge_notification_cycle_finished
                name: Notif. Fin de cycle
              - entity: switch.lave_linge_notification_alert_duration
                name: Notif. Dur√©e anormale
              - entity: switch.lave_linge_notification_unplugged
                name: Notif. D√©branch√©
              - type: divider
              - entity: button.lave_linge_reset_stats
      - type: vertical-stack
        cards:
          - type: custom:mushroom-template-card
            primary: Lave-Vaisselle
            secondary: |
              {% set state = states('sensor.lave_vaisselle_state') %}
              {% if state == 'running' %}
                üîµ Lavage en cours - {{ states('sensor.lave_vaisselle_cycle_duration') }} min
              {% elif state == 'finished' %}
                ‚úÖ Lavage termin√© - Vaisselle propre !
              {% else %}
                ‚ö™ Pr√™t
              {% endif %}
            icon: mdi:dishwasher
            icon_color: |
              {% set state = states('sensor.lave_vaisselle_state') %}
              {% if state == 'running' %}
                blue
              {% elif state == 'finished' %}
                green
              {% else %}
                grey
              {% endif %}
            badge_icon: |
              {% if is_state('binary_sensor.lave_vaisselle_unplugged', 'on') %}
                mdi:power-plug-off
              {% endif %}
            badge_color: |
              {% if is_state('binary_sensor.lave_vaisselle_unplugged', 'on') %}
                red
              {% endif %}
            tap_action:
              action: more-info
              entity: sensor.lave_vaisselle_state
            fill_container: true
          - type: horizontal-stack
            cards:
              - type: gauge
                entity: sensor.lave_vaisselle_cycle_duration
                name: Dur√©e cycle
                needle: true
                severity:
                  green: 0
                  yellow: 120
                  red: 180
                min: 0
                max: 240
                unit: min
              - type: entity
                entity: sensor.lave_vaisselle_cycle_energy
                name: √ânergie cycle
                icon: mdi:lightning-bolt
              - type: entity
                entity: sensor.lave_vaisselle_cycle_cost
                name: Co√ªt cycle
                icon: mdi:currency-eur
          - type: custom:mini-graph-card
            entities:
              - entity: sensor.lave_vaisselle_puissance
                name: Puissance
                color: '#16a085'
            name: Consommation (24h)
            hours_to_show: 24
            points_per_hour: 4
            line_width: 2
            animate: true
            show:
              labels: true
              points: false
              legend: true
              fill: fade
            icon: mdi:chart-line
          - type: horizontal-stack
            cards:
              - type: entities
                title: Dernier cycle
                entities:
                  - sensor.lave_vaisselle_last_cycle_duration
                  - sensor.lave_vaisselle_last_cycle_energy
                  - sensor.lave_vaisselle_last_cycle_cost
              - type: entities
                title: Aujourd'hui
                entities:
                  - sensor.lave_vaisselle_daily_cycles
                  - sensor.lave_vaisselle_daily_cost
              - type: entities
                title: Ce mois
                entities:
                  - sensor.lave_vaisselle_monthly_cost
          - type: entities
            title: Contr√¥les
            entities:
              - entity: switch.lave_vaisselle_monitoring
                name: Surveillance
                icon: mdi:eye
              - entity: switch.lave_vaisselle_notifications
                name: Notifications
                icon: mdi:bell
              - type: divider
              - entity: switch.lave_vaisselle_notification_cycle_started
                name: Notif. D√©marrage
              - entity: switch.lave_vaisselle_notification_cycle_finished
                name: Notif. Fin de cycle
              - entity: switch.lave_vaisselle_notification_alert_duration
                name: Notif. Dur√©e anormale
              - entity: switch.lave_vaisselle_notification_unplugged
                name: Notif. D√©branch√©
              - type: divider
              - entity: button.lave_vaisselle_reset_stats
      - type: vertical-stack
        cards:
          - type: custom:mushroom-template-card
            primary: Bambulab X1C
            secondary: |
              {% set state = states('sensor.bambulab_x1c_state') %}
              {% if state == 'running' %}
                üîµ Impression en cours - {{ states('sensor.bambulab_x1c_cycle_duration') }} min
              {% elif state == 'finished' %}
                ‚úÖ Impression termin√©e - {{ states('sensor.bambulab_x1c_last_cycle_duration') }} min
              {% else %}
                ‚ö™ Pr√™t
              {% endif %}
            icon: mdi:printer-3d
            icon_color: |
              {% set state = states('sensor.bambulab_x1c_state') %}
              {% if state == 'running' %}
                blue
              {% elif state == 'finished' %}
                green
              {% else %}
                grey
              {% endif %}
            badge_icon: |
              {% if is_state('binary_sensor.bambulab_x1c_alert_duration', 'on') %}
                mdi:alert
              {% elif is_state('binary_sensor.bambulab_x1c_unplugged', 'on') %}
                mdi:power-plug-off
              {% endif %}
            badge_color: >
              {% if is_state('binary_sensor.bambulab_x1c_alert_duration', 'on') or
              is_state('binary_sensor.bambulab_x1c_unplugged', 'on') %}
                red
              {% endif %}
            tap_action:
              action: more-info
              entity: sensor.bambulab_x1c_state
            fill_container: true
          - type: horizontal-stack
            cards:
              - type: gauge
                entity: sensor.bambulab_x1c_cycle_duration
                name: Dur√©e impression
                needle: true
                severity:
                  green: 0
                  yellow: 240
                  red: 480
                min: 0
                max: 600
                unit: min
              - type: entity
                entity: sensor.bambulab_x1c_cycle_energy
                name: √ânergie cycle
                icon: mdi:lightning-bolt
              - type: entity
                entity: sensor.bambulab_x1c_cycle_cost
                name: Co√ªt cycle
                icon: mdi:currency-eur
          - type: custom:mini-graph-card
            entities:
              - entity: sensor.bambulab_x1c_puissance
                name: Puissance
                color: '#e74c3c'
            name: Consommation (24h)
            hours_to_show: 24
            points_per_hour: 4
            line_width: 2
            animate: true
            show:
              labels: true
              points: false
              legend: true
              fill: fade
            icon: mdi:chart-line
          - type: horizontal-stack
            cards:
              - type: entities
                title: Derni√®re impression
                entities:
                  - sensor.bambulab_x1c_last_cycle_duration
                  - sensor.bambulab_x1c_last_cycle_energy
                  - sensor.bambulab_x1c_last_cycle_cost
              - type: entities
                title: Aujourd'hui
                entities:
                  - sensor.bambulab_x1c_daily_cycles
                  - sensor.bambulab_x1c_daily_cost
              - type: entities
                title: Ce mois
                entities:
                  - sensor.bambulab_x1c_monthly_cost
          - type: entities
            title: Contr√¥les
            entities:
              - entity: switch.bambulab_x1c_monitoring
                name: Surveillance
                icon: mdi:eye
              - entity: switch.bambulab_x1c_notifications
                name: Notifications
                icon: mdi:bell
              - type: divider
              - entity: switch.bambulab_x1c_notification_cycle_started
                name: Notif. D√©marrage
              - entity: switch.bambulab_x1c_notification_cycle_finished
                name: Notif. Fin impression
              - entity: switch.bambulab_x1c_notification_alert_duration
                name: Notif. Dur√©e anormale
              - entity: switch.bambulab_x1c_notification_unplugged
                name: Notif. D√©branch√©
              - type: divider
              - entity: button.bambulab_x1c_reset_stats
      - type: vertical-stack
        cards:
          - type: custom:mushroom-template-card
            primary: Chauffe-Eau
            secondary: |
              {% set state = states('sensor.chauffe_eau_state') %}
              {% if state == 'running' %}
                üîµ Chauffe en cours - {{ states('sensor.chauffe_eau_cycle_duration') }} min
              {% elif state == 'finished' %}
                ‚úÖ Chauffe termin√©e
              {% else %}
                ‚ö™ Inactif
              {% endif %}
            icon: mdi:water-boiler
            icon_color: |
              {% set state = states('sensor.chauffe_eau_state') %}
              {% if state == 'running' %}
                blue
              {% elif state == 'finished' %}
                green
              {% else %}
                grey
              {% endif %}
            badge_icon: |
              {% if is_state('binary_sensor.chauffe_eau_unplugged', 'on') %}
                mdi:power-plug-off
              {% endif %}
            badge_color: |
              {% if is_state('binary_sensor.chauffe_eau_unplugged', 'on') %}
                red
              {% endif %}
            tap_action:
              action: more-info
              entity: sensor.chauffe_eau_state
            fill_container: true
          - type: horizontal-stack
            cards:
              - type: gauge
                entity: sensor.chauffe_eau_cycle_duration
                name: Dur√©e cycle
                needle: true
                severity:
                  green: 0
                  yellow: 120
                  red: 240
                min: 0
                max: 360
                unit: min
              - type: entity
                entity: sensor.chauffe_eau_cycle_energy
                name: √ânergie cycle
                icon: mdi:lightning-bolt
              - type: entity
                entity: sensor.chauffe_eau_cycle_cost
                name: Co√ªt cycle
                icon: mdi:currency-eur
          - type: custom:mini-graph-card
            entities:
              - entity: sensor.chauffe_eau_energy_power
                name: Puissance
                color: '#f39c12'
            name: Consommation (24h)
            hours_to_show: 24
            points_per_hour: 4
            line_width: 2
            animate: true
            show:
              labels: true
              points: false
              legend: true
              fill: fade
            icon: mdi:chart-line
          - type: horizontal-stack
            cards:
              - type: entities
                title: Dernier cycle
                entities:
                  - sensor.chauffe_eau_last_cycle_duration
                  - sensor.chauffe_eau_last_cycle_energy
                  - sensor.chauffe_eau_last_cycle_cost
              - type: entities
                title: Aujourd'hui
                entities:
                  - sensor.chauffe_eau_daily_cycles
                  - sensor.chauffe_eau_daily_cost
              - type: entities
                title: Ce mois
                entities:
                  - sensor.chauffe_eau_monthly_cost
          - type: entities
            title: Contr√¥les
            entities:
              - entity: switch.chauffe_eau_monitoring
                name: Surveillance
                icon: mdi:eye
              - entity: switch.chauffe_eau_notifications
                name: Notifications
                icon: mdi:bell
              - type: divider
              - entity: switch.chauffe_eau_notification_cycle_started
                name: Notif. D√©marrage
              - entity: switch.chauffe_eau_notification_cycle_finished
                name: Notif. Fin de cycle
              - entity: switch.chauffe_eau_notification_alert_duration
                name: Notif. Dur√©e anormale
              - entity: switch.chauffe_eau_notification_unplugged
                name: Notif. D√©branch√©
              - type: divider
              - entity: button.chauffe_eau_reset_stats
      - type: vertical-stack
        cards:
          - type: custom:mushroom-template-card
            primary: √âcran PC
            secondary: |
              {% set state = states('sensor.ecran_pc_state') %}
              {% if state == 'running' %}
                üîµ Allum√© - {{ states('sensor.ecran_pc_cycle_duration') }} min
              {% elif state == 'finished' %}
                ‚úÖ Session termin√©e - {{ states('sensor.ecran_pc_last_cycle_duration') }} min
              {% else %}
                ‚ö™ √âteint
              {% endif %}
            icon: mdi:monitor
            icon_color: |
              {% set state = states('sensor.ecran_pc_state') %}
              {% if state == 'running' %}
                blue
              {% elif state == 'finished' %}
                green
              {% else %}
                grey
              {% endif %}
            badge_icon: |
              {% if is_state('binary_sensor.ecran_pc_alert_duration', 'on') %}
                mdi:alert
              {% elif is_state('binary_sensor.ecran_pc_unplugged', 'on') %}
                mdi:power-plug-off
              {% endif %}
            badge_color: >
              {% if is_state('binary_sensor.ecran_pc_alert_duration', 'on') or
              is_state('binary_sensor.ecran_pc_unplugged', 'on') %}
                red
              {% endif %}
            tap_action:
              action: more-info
              entity: sensor.ecran_pc_state
            fill_container: true
          - type: horizontal-stack
            cards:
              - type: gauge
                entity: sensor.ecran_pc_cycle_duration
                name: Dur√©e session
                needle: true
                severity:
                  green: 0
                  yellow: 240
                  red: 480
                min: 0
                max: 600
                unit: min
              - type: entity
                entity: sensor.ecran_pc_cycle_energy
                name: √ânergie session
                icon: mdi:lightning-bolt
              - type: entity
                entity: sensor.ecran_pc_cycle_cost
                name: Co√ªt session
                icon: mdi:currency-eur
          - type: custom:mini-graph-card
            entities:
              - entity: sensor.ecran_pc_puissance
                name: Puissance
                color: '#95a5a6'
            name: Consommation (24h)
            hours_to_show: 24
            points_per_hour: 4
            line_width: 2
            animate: true
            show:
              labels: true
              points: false
              legend: true
              fill: fade
            icon: mdi:chart-line
          - type: horizontal-stack
            cards:
              - type: entities
                title: Derni√®re session
                entities:
                  - sensor.ecran_pc_last_cycle_duration
                  - sensor.ecran_pc_last_cycle_energy
                  - sensor.ecran_pc_last_cycle_cost
              - type: entities
                title: Aujourd'hui
                entities:
                  - sensor.ecran_pc_daily_cycles
                  - sensor.ecran_pc_daily_cost
              - type: entities
                title: Ce mois
                entities:
                  - sensor.ecran_pc_monthly_cost
          - type: entities
            title: Contr√¥les
            entities:
              - entity: switch.ecran_pc_monitoring
                name: Surveillance
                icon: mdi:eye
              - entity: switch.ecran_pc_notifications
                name: Notifications
                icon: mdi:bell
              - type: divider
              - entity: switch.ecran_pc_notification_cycle_started
                name: Notif. Allumage
              - entity: switch.ecran_pc_notification_cycle_finished
                name: Notif. Extinction
              - entity: switch.ecran_pc_notification_alert_duration
                name: Notif. Dur√©e anormale
              - entity: switch.ecran_pc_notification_unplugged
                name: Notif. D√©branch√©
              - type: divider
              - entity: button.ecran_pc_reset_stats
      - type: vertical-stack
        cards:
          - type: custom:mushroom-template-card
            primary: Four
            secondary: |
              {% set state = states('sensor.four_state') %}
              {% if state == 'running' %}
                üîµ Cuisson en cours - {{ states('sensor.four_cycle_duration') }} min
              {% elif state == 'finished' %}
                ‚úÖ Cuisson termin√©e - {{ states('sensor.four_last_cycle_duration') }} min
              {% else %}
                ‚ö™ √âteint
              {% endif %}
            icon: mdi:stove
            icon_color: |
              {% set state = states('sensor.four_state') %}
              {% if state == 'running' %}
                blue
              {% elif state == 'finished' %}
                green
              {% else %}
                grey
              {% endif %}
            badge_icon: |
              {% if is_state('binary_sensor.four_unplugged', 'on') %}
                mdi:power-plug-off
              {% endif %}
            badge_color: |
              {% if is_state('binary_sensor.four_unplugged', 'on') %}
                red
              {% endif %}
            tap_action:
              action: more-info
              entity: sensor.four_state
            fill_container: true
          - type: horizontal-stack
            cards:
              - type: gauge
                entity: sensor.four_cycle_duration
                name: Dur√©e cuisson
                needle: true
                severity:
                  green: 0
                  yellow: 60
                  red: 120
                min: 0
                max: 180
                unit: min
              - type: entity
                entity: sensor.four_cycle_energy
                name: √ânergie cycle
                icon: mdi:lightning-bolt
              - type: entity
                entity: sensor.four_cycle_cost
                name: Co√ªt cycle
                icon: mdi:currency-eur
          - type: custom:mini-graph-card
            entities:
              - entity: sensor.four_puissance
                name: Puissance
                color: '#9b59b6'
            name: Consommation (24h)
            hours_to_show: 24
            points_per_hour: 4
            line_width: 2
            animate: true
            show:
              labels: true
              points: false
              legend: true
              fill: fade
            icon: mdi:chart-line
          - type: horizontal-stack
            cards:
              - type: entities
                title: Derni√®re cuisson
                entities:
                  - sensor.four_last_cycle_duration
                  - sensor.four_last_cycle_energy
                  - sensor.four_last_cycle_cost
              - type: entities
                title: Aujourd'hui
                entities:
                  - sensor.four_daily_cycles
                  - sensor.four_daily_cost
              - type: entities
                title: Ce mois
                entities:
                  - sensor.four_monthly_cost
          - type: entities
            title: Contr√¥les
            entities:
              - entity: switch.four_monitoring
                name: Surveillance
                icon: mdi:eye
              - entity: switch.four_notifications
                name: Notifications
                icon: mdi:bell
              - type: divider
              - entity: switch.four_notification_cycle_started
                name: Notif. D√©marrage
              - entity: switch.four_notification_cycle_finished
                name: Notif. Fin de cuisson
              - entity: switch.four_notification_alert_duration
                name: Notif. Dur√©e anormale
              - entity: switch.four_notification_unplugged
                name: Notif. D√©branch√©
              - type: divider
              - entity: button.four_reset_stats
      - type: vertical-stack
        cards:
          - type: custom:mushroom-template-card
            primary: S√®che-Linge
            secondary: |
              {% set state = states('sensor.seche_linge_state') %}
              {% if state == 'running' %}
                üîµ S√©chage en cours - {{ states('sensor.seche_linge_cycle_duration') }} min
              {% elif state == 'finished' %}
                ‚úÖ S√©chage termin√© - {{ states('sensor.seche_linge_last_cycle_duration') }} min
              {% else %}
                ‚ö™ Pr√™t
              {% endif %}
            icon: mdi:tumble-dryer
            icon_color: |
              {% set state = states('sensor.seche_linge_state') %}
              {% if state == 'running' %}
                blue
              {% elif state == 'finished' %}
                green
              {% else %}
                grey
              {% endif %}
            badge_icon: |
              {% if is_state('binary_sensor.seche_linge_unplugged', 'on') %}
                mdi:power-plug-off
              {% endif %}
            badge_color: |
              {% if is_state('binary_sensor.seche_linge_unplugged', 'on') %}
                red
              {% endif %}
            tap_action:
              action: more-info
              entity: sensor.seche_linge_state
            fill_container: true
          - type: horizontal-stack
            cards:
              - type: gauge
                entity: sensor.seche_linge_cycle_duration
                name: Dur√©e cycle
                needle: true
                severity:
                  green: 0
                  yellow: 90
                  red: 150
                min: 0
                max: 180
                unit: min
              - type: entity
                entity: sensor.seche_linge_cycle_energy
                name: √ânergie cycle
                icon: mdi:lightning-bolt
              - type: entity
                entity: sensor.seche_linge_cycle_cost
                name: Co√ªt cycle
                icon: mdi:currency-eur
          - type: custom:mini-graph-card
            entities:
              - entity: sensor.seche_linge_puissance_2
                name: Puissance
                color: '#e67e22'
            name: Consommation (24h)
            hours_to_show: 24
            points_per_hour: 4
            line_width: 2
            animate: true
            show:
              labels: true
              points: false
              legend: true
              fill: fade
            icon: mdi:chart-line
          - type: horizontal-stack
            cards:
              - type: entities
                title: Dernier cycle
                entities:
                  - sensor.seche_linge_last_cycle_duration
                  - sensor.seche_linge_last_cycle_energy
                  - sensor.seche_linge_last_cycle_cost
              - type: entities
                title: Aujourd'hui
                entities:
                  - sensor.seche_linge_daily_cycles
                  - sensor.seche_linge_daily_cost
              - type: entities
                title: Ce mois
                entities:
                  - sensor.seche_linge_monthly_cost
          - type: entities
            title: Contr√¥les
            entities:
              - entity: switch.seche_linge_monitoring
                name: Surveillance
                icon: mdi:eye
              - entity: switch.seche_linge_notifications
                name: Notifications
                icon: mdi:bell
              - type: divider
              - entity: switch.seche_linge_notification_cycle_started
                name: Notif. D√©marrage
              - entity: switch.seche_linge_notification_cycle_finished
                name: Notif. Fin de cycle
              - entity: switch.seche_linge_notification_alert_duration
                name: Notif. Dur√©e anormale
              - entity: switch.seche_linge_notification_unplugged
                name: Notif. D√©branch√©
              - type: divider
              - entity: button.seche_linge_reset_stats
      - type: vertical-stack
        cards:
          - type: custom:mushroom-template-card
            primary: VMC
            secondary: |
              {% set state = states('sensor.vmc_state') %}
              {% if state == 'running' %}
                üîµ En marche - {{ states('sensor.vmc_session_duration') }} min
              {% elif state == 'finished' %}
                ‚úÖ Session termin√©e - {{ states('sensor.vmc_last_session_duration') }} min
              {% else %}
                ‚ö™ Arr√™t√©e
              {% endif %}
            icon: mdi:air-filter
            icon_color: |
              {% set state = states('sensor.vmc_state') %}
              {% if state == 'running' %}
                blue
              {% elif state == 'finished' %}
                green
              {% else %}
                grey
              {% endif %}
            badge_icon: |
              {% if is_state('switch.vmc_boost_vmc', 'on') %}
                mdi:rocket-launch
              {% elif is_state('binary_sensor.vmc_unplugged', 'on') %}
                mdi:power-plug-off
              {% endif %}
            badge_color: |
              {% if is_state('switch.vmc_boost_vmc', 'on') %}
                orange
              {% elif is_state('binary_sensor.vmc_unplugged', 'on') %}
                red
              {% endif %}
            tap_action:
              action: more-info
              entity: sensor.vmc_state
            fill_container: true
          - type: horizontal-stack
            cards:
              - type: gauge
                entity: sensor.vmc_session_duration
                name: Dur√©e session
                needle: true
                severity:
                  green: 0
                  yellow: 120
                  red: 240
                min: 0
                max: 360
                unit: min
              - type: entity
                entity: sensor.vmc_session_energy
                name: √ânergie session
                icon: mdi:lightning-bolt
              - type: entity
                entity: sensor.vmc_session_cost
                name: Co√ªt session
                icon: mdi:currency-eur
          - type: custom:mini-graph-card
            entities:
              - entity: sensor.vmc_device_power
                name: Puissance
                color: '#1abc9c'
            name: Consommation (24h)
            hours_to_show: 24
            points_per_hour: 4
            line_width: 2
            animate: true
            show:
              labels: true
              points: false
              legend: true
              fill: fade
            icon: mdi:chart-line
          - type: horizontal-stack
            cards:
              - type: entities
                title: Derni√®re session
                entities:
                  - sensor.vmc_last_session_duration
                  - sensor.vmc_last_session_energy
                  - sensor.vmc_last_session_cost
              - type: entities
                title: Aujourd'hui
                entities:
                  - sensor.vmc_daily_sessions
                  - sensor.vmc_daily_cost
              - type: entities
                title: Ce mois
                entities:
                  - sensor.vmc_monthly_cost
          - type: entities
            title: Contr√¥les
            entities:
              - entity: switch.vmc
                name: VMC
                icon: mdi:fan
              - entity: switch.vmc_boost_vmc
                name: Mode Boost
                icon: mdi:rocket-launch
              - entity: timer.timer_vmc_boost
                name: Timer Boost
                icon: mdi:timer
              - type: divider
              - entity: switch.vmc_monitoring
                name: Surveillance
                icon: mdi:eye
              - entity: switch.vmc_notifications
                name: Notifications
                icon: mdi:bell
              - type: divider
              - entity: switch.vmc_notification_cycle_started
                name: Notif. D√©marrage
              - entity: switch.vmc_notification_cycle_finished
                name: Notif. Fin de session
              - entity: switch.vmc_notification_alert_duration
                name: Notif. Dur√©e anormale
              - entity: switch.vmc_notification_unplugged
                name: Notif. D√©branch√©
              - type: divider
              - entity: button.vmc_reset_stats
      - type: vertical-stack
        cards:
          - type: custom:mushroom-template-card
            primary: PC Bureau
            secondary: |
              {% set state = states('sensor.bureau_pc_state') %}
              {% if state == 'running' %}
                üîµ Allum√© - {{ states('sensor.bureau_pc_cycle_duration') }} min
              {% elif state == 'finished' %}
                ‚úÖ Session termin√©e - {{ states('sensor.bureau_pc_last_cycle_duration') }} min
              {% else %}
                ‚ö™ √âteint
              {% endif %}
            icon: mdi:desktop-tower
            icon_color: |
              {% set state = states('sensor.bureau_pc_state') %}
              {% if state == 'running' %}
                blue
              {% elif state == 'finished' %}
                green
              {% else %}
                grey
              {% endif %}
            badge_icon: |
              {% if is_state('binary_sensor.bureau_pc_unplugged', 'on') %}
                mdi:power-plug-off
              {% endif %}
            badge_color: |
              {% if is_state('binary_sensor.bureau_pc_unplugged', 'on') %}
                red
              {% endif %}
            tap_action:
              action: more-info
              entity: sensor.bureau_pc_state
            fill_container: true
          - type: horizontal-stack
            cards:
              - type: gauge
                entity: sensor.bureau_pc_cycle_duration
                name: Dur√©e utilisation
                needle: true
                severity:
                  green: 0
                  yellow: 240
                  red: 480
                min: 0
                max: 600
                unit: min
              - type: entity
                entity: sensor.bureau_pc_cycle_energy
                name: √ânergie cycle
                icon: mdi:lightning-bolt
              - type: entity
                entity: sensor.bureau_pc_cycle_cost
                name: Co√ªt cycle
                icon: mdi:currency-eur
          - type: custom:mini-graph-card
            entities:
              - entity: sensor.bureau_pc_puissance
                name: Puissance
                color: '#34495e'
            name: Consommation (24h)
            hours_to_show: 24
            points_per_hour: 4
            line_width: 2
            animate: true
            show:
              labels: true
              points: false
              legend: true
              fill: fade
            icon: mdi:chart-line
          - type: horizontal-stack
            cards:
              - type: entities
                title: Dernier cycle
                entities:
                  - sensor.bureau_pc_last_cycle_duration
                  - sensor.bureau_pc_last_cycle_energy
                  - sensor.bureau_pc_last_cycle_cost
              - type: entities
                title: Aujourd'hui
                entities:
                  - sensor.bureau_pc_daily_cycles
                  - sensor.bureau_pc_daily_cost
              - type: entities
                title: Ce mois
                entities:
                  - sensor.bureau_pc_monthly_cost
          - type: entities
            title: Contr√¥les
            entities:
              - entity: switch.bureau_pc_monitoring
                name: Surveillance
                icon: mdi:eye
              - entity: switch.bureau_pc_notifications
                name: Notifications
                icon: mdi:bell
              - type: divider
              - entity: switch.bureau_pc_notification_cycle_started
                name: Notif. D√©marrage
              - entity: switch.bureau_pc_notification_cycle_finished
                name: Notif. Fin de cycle
              - entity: switch.bureau_pc_notification_alert_duration
                name: Notif. Dur√©e anormale
              - entity: switch.bureau_pc_notification_unplugged
                name: Notif. D√©branch√©
              - type: divider
              - entity: button.bureau_pc_reset_stats
  - title: Custom Cards Test
    path: custom_cards
    icon: mdi:cards-playing-outline
    badges: []
    cards:
      - type: markdown
        content: |
          # üé¥ Smart Appliance Monitor - Toutes les Cartes Custom
          
          Vue d'ensemble de tous les appareils surveill√©s avec les nouvelles cartes
      
      - type: vertical-stack
        cards:
          - type: markdown
            content: "## üß∫ Lave-Linge"
          - type: custom:smart-appliance-cycle-card
            entity: sensor.lave_linge_state
            name: "Lave-Linge"
            show_current_power: true
          - type: custom:smart-appliance-stats-card
            entity: sensor.lave_linge_state
            name: "Statistiques D√©taill√©es"
            default_tab: week
            show_trends: true
            show_efficiency: true
            theme: auto
      
      - type: vertical-stack
        cards:
          - type: markdown
            content: "## üçΩÔ∏è Lave-Vaisselle"
          - type: custom:smart-appliance-cycle-card
            entity: sensor.lave_vaisselle_state
            name: "Lave-Vaisselle"
            show_current_power: true
          - type: custom:smart-appliance-stats-card
            entity: sensor.lave_vaisselle_state
            name: "Statistiques D√©taill√©es"
            default_tab: week
            show_trends: true
            show_efficiency: true
            theme: auto
      
      - type: vertical-stack
        cards:
          - type: markdown
            content: "## üñ®Ô∏è Bambulab X1C"
          - type: custom:smart-appliance-cycle-card
            entity: sensor.bambulab_x1c_state
            name: "Bambulab X1C"
            show_current_power: true
          - type: custom:smart-appliance-stats-card
            entity: sensor.bambulab_x1c_state
            name: "Statistiques D√©taill√©es"
            default_tab: week
            show_trends: true
            show_efficiency: true
            theme: auto
      
      - type: vertical-stack
        cards:
          - type: markdown
            content: "## üöø Chauffe-Eau"
          - type: custom:smart-appliance-cycle-card
            entity: sensor.chauffe_eau_state
            name: "Chauffe-Eau"
            show_current_power: true
          - type: custom:smart-appliance-stats-card
            entity: sensor.chauffe_eau_state
            name: "Statistiques D√©taill√©es"
            default_tab: week
            show_trends: true
            show_efficiency: true
            theme: auto
      
      - type: vertical-stack
        cards:
          - type: markdown
            content: "## üñ•Ô∏è √âcran PC"
          - type: custom:smart-appliance-cycle-card
            entity: sensor.ecran_pc_state
            name: "√âcran PC"
            show_current_power: true
          - type: custom:smart-appliance-stats-card
            entity: sensor.ecran_pc_state
            name: "Statistiques D√©taill√©es"
            default_tab: week
            show_trends: true
            show_efficiency: true
            theme: auto
      
      - type: vertical-stack
        cards:
          - type: markdown
            content: "## üçï Four"
          - type: custom:smart-appliance-cycle-card
            entity: sensor.four_state
            name: "Four"
            show_current_power: true
          - type: custom:smart-appliance-stats-card
            entity: sensor.four_state
            name: "Statistiques D√©taill√©es"
            default_tab: week
            show_trends: true
            show_efficiency: true
            theme: auto
      
      - type: vertical-stack
        cards:
          - type: markdown
            content: "## üëï S√®che-Linge"
          - type: custom:smart-appliance-cycle-card
            entity: sensor.seche_linge_state
            name: "S√®che-Linge"
            show_current_power: true
          - type: custom:smart-appliance-stats-card
            entity: sensor.seche_linge_state
            name: "Statistiques D√©taill√©es"
            default_tab: week
            show_trends: true
            show_efficiency: true
            theme: auto
      
      - type: vertical-stack
        cards:
          - type: markdown
            content: "## üí® VMC"
          - type: custom:smart-appliance-cycle-card
            entity: sensor.vmc_state
            name: "VMC"
            show_current_power: true
          - type: custom:smart-appliance-stats-card
            entity: sensor.vmc_state
            name: "Statistiques D√©taill√©es"
            default_tab: week
            show_trends: true
            show_efficiency: true
            theme: auto
      
      - type: vertical-stack
        cards:
          - type: markdown
            content: "## üíª PC Bureau"
          - type: custom:smart-appliance-cycle-card
            entity: sensor.bureau_pc_state
            name: "PC Bureau"
            show_current_power: true
          - type: custom:smart-appliance-stats-card
            entity: sensor.bureau_pc_state
            name: "Statistiques D√©taill√©es"
            default_tab: week
            show_trends: true
            show_efficiency: true
            theme: auto


  # Vue co√ªts
  - title: Co√ªts
    path: costs
    icon: mdi:currency-eur
    cards:
      - type: markdown
        content: |
          ## üí∞ Analyse des Co√ªts

      # Co√ªt total estim√©
      - type: gauge
        entity: sensor.index_edf_galinky
        name: Co√ªt Total Estim√© (Aujourd'hui)
        unit: "‚Ç¨"
        min: 0
        max: 20
        severity:
          green: 0
          yellow: 10
          red: 15
        needle: true

      # Co√ªts par appareil
      - type: custom:auto-entities
        card:
          type: entities
          title: Co√ªts par Appareil (Aujourd'hui)
        filter:
          include:
            - entity_id: sensor.chauffe_eau_daily_cost
              name: "üíß Chauffe-eau"
            - entity_id: sensor.lave_linge_daily_cost
              name: "üß∫ Lave-linge"
            - entity_id: sensor.four_daily_cost
              name: "üçï Four"
            - entity_id: sensor.lave_vaisselle_daily_cost
              name: "üçΩÔ∏è Lave-vaisselle"
            - entity_id: sensor.seche_linge_daily_cost
              name: "üëï S√®che-linge"
            - entity_id: sensor.ecran_pc_daily_cost
              name: "üñ•Ô∏è √âcran PC"
            - entity_id: sensor.bambulab_x1c_daily_cost
              name: "üñ®Ô∏è Imprimante 3D"
            - entity_id: sensor.vmc_daily_cost
              name: "üí® VMC"
            - entity_id: sensor.bureau_pc_daily_cost
              name: "üíª PC Bureau"
        sort:
          method: state
          numeric: true
          reverse: true

      # Graphique co√ªts mensuels
      - type: custom:apexcharts-card
        header:
          show: true
          title: üìä Co√ªts Mensuels
        graph_span: 30d
        span:
          end: day
        all_series_config:
          type: column
          group_by:
            func: last
            duration: 1d
        series:
          - entity: sensor.chauffe_eau_daily_cost
            name: Chauffe-eau
          - entity: sensor.lave_linge_daily_cost
            name: Lave-linge
          - entity: sensor.four_daily_cost
            name: Four
          - entity: sensor.lave_vaisselle_daily_cost
            name: Lave-vaisselle
          - entity: sensor.seche_linge_daily_cost
            name: S√®che-linge

      # Estimations mensuelles
      - type: entities
        title: üí≥ Estimations Mensuelles
        entities:
          - entity: sensor.chauffe_eau_monthly_cost
            name: Chauffe-eau
          - entity: sensor.lave_linge_monthly_cost
            name: Lave-linge
          - entity: sensor.four_monthly_cost
            name: Four
          - entity: sensor.lave_vaisselle_monthly_cost
            name: Lave-vaisselle
          - entity: sensor.seche_linge_monthly_cost
            name: S√®che-linge

  # Vue Contr√¥les
  - title: Contr√¥les
    path: controls
    icon: mdi:tune-variant
    cards:
      - type: markdown
        content: |
          ## üéõÔ∏è Contr√¥les & Supervision

      # √âtats en temps r√©el
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              ### üìä √âtats en Temps R√©el
          
          - type: custom:auto-entities
            card:
              type: entities
              title: √âtat des Appareils
              state_color: true
            filter:
              include:
                - entity_id: sensor.chauffe_eau_state
                  name: "üíß Chauffe-eau"
                - entity_id: sensor.lave_linge_state
                  name: "üß∫ Lave-linge"
                - entity_id: sensor.four_state
                  name: "üçï Four"
                - entity_id: sensor.lave_vaisselle_state
                  name: "üçΩÔ∏è Lave-vaisselle"
                - entity_id: sensor.seche_linge_state
                  name: "üëï S√®che-linge"
                - entity_id: sensor.ecran_pc_state
                  name: "üñ•Ô∏è √âcran PC"
                - entity_id: sensor.bambulab_x1c_state
                  name: "üñ®Ô∏è Imprimante 3D"
                - entity_id: sensor.vmc_state
                  name: "üí® VMC"
                - entity_id: sensor.bureau_pc_state
                  name: "üíª PC Bureau"

      # Appareils en cours d'utilisation
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              ### ‚ö° Cycles en Cours
          
          - type: custom:auto-entities
            card:
              type: entities
              title: Dur√©e des Cycles Actifs
            filter:
              include:
                - entity_id: sensor.chauffe_eau_duree_cycle
                  name: "üíß Chauffe-eau"
                - entity_id: sensor.lave_linge_duree_cycle
                  name: "üß∫ Lave-linge"
                - entity_id: sensor.four_duree_cycle
                  name: "üçï Four"
                - entity_id: sensor.lave_vaisselle_duree_cycle
                  name: "üçΩÔ∏è Lave-vaisselle"
                - entity_id: sensor.seche_linge_duree_cycle
                  name: "üëï S√®che-linge"
                - entity_id: sensor.ecran_pc_duree_cycle
                  name: "üñ•Ô∏è √âcran PC"
                - entity_id: sensor.bambulab_x1c_duree_cycle
                  name: "üñ®Ô∏è Imprimante 3D"
                - entity_id: sensor.vmc_duree_cycle
                  name: "üí® VMC"
                - entity_id: sensor.bureau_pc_duree_cycle
                  name: "üíª PC Bureau"
              exclude:
                - state: "0"
                - state: "unavailable"

      # Switches de monitoring
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              ### üîç Switches de Monitoring
          
          - type: entities
            title: Monitoring Actif
            entities:
              - entity: switch.chauffe_eau_monitoring
                name: "üíß Chauffe-eau"
              - entity: switch.lave_linge_monitoring
                name: "üß∫ Lave-linge"
              - entity: switch.four_monitoring
                name: "üçï Four"
              - entity: switch.lave_vaisselle_monitoring
                name: "üçΩÔ∏è Lave-vaisselle"
              - entity: switch.seche_linge_monitoring
                name: "üëï S√®che-linge"
              - entity: switch.ecran_pc_monitoring
                name: "üñ•Ô∏è √âcran PC"
              - entity: switch.bambulab_x1c_monitoring
                name: "üñ®Ô∏è Imprimante 3D"
              - entity: switch.vmc_monitoring
                name: "üí® VMC"
              - entity: switch.bureau_pc_monitoring
                name: "üíª PC Bureau"

      # Switches de notifications master
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              ### üîî Notifications Master
          
          - type: entities
            title: Notifications G√©n√©rales
            entities:
              - entity: switch.chauffe_eau_notifications
                name: "üíß Chauffe-eau"
              - entity: switch.lave_linge_notifications
                name: "üß∫ Lave-linge"
              - entity: switch.four_notifications
                name: "üçï Four"
              - entity: switch.lave_vaisselle_notifications
                name: "üçΩÔ∏è Lave-vaisselle"
              - entity: switch.seche_linge_notifications
                name: "üëï S√®che-linge"
              - entity: switch.ecran_pc_notifications
                name: "üñ•Ô∏è √âcran PC"
              - entity: switch.bambulab_x1c_notifications
                name: "üñ®Ô∏è Imprimante 3D"
              - entity: switch.vmc_notifications
                name: "üí® VMC"
              - entity: switch.bureau_pc_notifications
                name: "üíª PC Bureau"

      # Notifications par type
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              ### üîî Notifications par Type
          
          - type: custom:mushroom-title-card
            title: Cycle D√©marr√©
          
          - type: entities
            entities:
              - entity: switch.chauffe_eau_notification_cycle_started
                name: "üíß Chauffe-eau"
              - entity: switch.lave_linge_notification_cycle_started
                name: "üß∫ Lave-linge"
              - entity: switch.four_notification_cycle_started
                name: "üçï Four"
              - entity: switch.lave_vaisselle_notification_cycle_started
                name: "üçΩÔ∏è Lave-vaisselle"
              - entity: switch.seche_linge_notification_cycle_started
                name: "üëï S√®che-linge"
          
          - type: custom:mushroom-title-card
            title: Cycle Termin√©
          
          - type: entities
            entities:
              - entity: switch.chauffe_eau_notification_cycle_finished
                name: "üíß Chauffe-eau"
              - entity: switch.lave_linge_notification_cycle_finished
                name: "üß∫ Lave-linge"
              - entity: switch.four_notification_cycle_finished
                name: "üçï Four"
              - entity: switch.lave_vaisselle_notification_cycle_finished
                name: "üçΩÔ∏è Lave-vaisselle"
              - entity: switch.seche_linge_notification_cycle_finished
                name: "üëï S√®che-linge"
          
          - type: custom:mushroom-title-card
            title: Alerte Dur√©e
          
          - type: entities
            entities:
              - entity: switch.chauffe_eau_notification_alert_duration
                name: "üíß Chauffe-eau"
              - entity: switch.lave_linge_notification_alert_duration
                name: "üß∫ Lave-linge"
              - entity: switch.four_notification_alert_duration
                name: "üçï Four"
              - entity: switch.lave_vaisselle_notification_alert_duration
                name: "üçΩÔ∏è Lave-vaisselle"
              - entity: switch.seche_linge_notification_alert_duration
                name: "üëï S√®che-linge"
          
          - type: custom:mushroom-title-card
            title: Alerte D√©branch√©
          
          - type: entities
            entities:
              - entity: switch.chauffe_eau_notification_unplugged
                name: "üíß Chauffe-eau"
              - entity: switch.lave_linge_notification_unplugged
                name: "üß∫ Lave-linge"
              - entity: switch.four_notification_unplugged
                name: "üçï Four"
              - entity: switch.lave_vaisselle_notification_unplugged
                name: "üçΩÔ∏è Lave-vaisselle"
              - entity: switch.seche_linge_notification_unplugged
                name: "üëï S√®che-linge"

  # Vue Alertes & Anomalies
  - title: Alertes & Anomalies
    path: alerts
    icon: mdi:alert-circle
    cards:
      - type: markdown
        content: |
          ## ‚ö†Ô∏è Alertes & D√©tection d'Anomalies

      # Alertes actives
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              ### üö® Alertes Actives
          
          - type: custom:auto-entities
            card:
              type: entities
              title: Alertes de Dur√©e
              state_color: true
            filter:
              include:
                - entity_id: binary_sensor.chauffe_eau_alert_duration
                - entity_id: binary_sensor.lave_linge_alert_duration
                - entity_id: binary_sensor.four_alert_duration
                - entity_id: binary_sensor.lave_vaisselle_alert_duration
                - entity_id: binary_sensor.seche_linge_alert_duration
                - entity_id: binary_sensor.ecran_pc_alert_duration
                - entity_id: binary_sensor.bambulab_x1c_alert_duration
                - entity_id: binary_sensor.vmc_alert_duration
                - entity_id: binary_sensor.bureau_pc_alert_duration
              exclude:
                - state: "off"
                - state: "unavailable"
          
          - type: custom:auto-entities
            card:
              type: entities
              title: Alertes D√©branch√©
              state_color: true
            filter:
              include:
                - entity_id: binary_sensor.chauffe_eau_unplugged
                - entity_id: binary_sensor.lave_linge_unplugged
                - entity_id: binary_sensor.four_unplugged
                - entity_id: binary_sensor.lave_vaisselle_unplugged
                - entity_id: binary_sensor.seche_linge_unplugged
                - entity_id: binary_sensor.ecran_pc_unplugged
                - entity_id: binary_sensor.bambulab_x1c_unplugged
                - entity_id: binary_sensor.vmc_unplugged
                - entity_id: binary_sensor.bureau_pc_unplugged
              exclude:
                - state: "off"
                - state: "unavailable"

      # D√©tection d'anomalies
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              ### üîç D√©tection d'Anomalies
          
          - type: horizontal-stack
            cards:
              - type: gauge
                entity: sensor.chauffe_eau_anomaly_score
                name: Chauffe-eau
                min: 0
                max: 100
                needle: true
                severity:
                  green: 0
                  yellow: 30
                  red: 60
              
              - type: gauge
                entity: sensor.lave_linge_anomaly_score
                name: Lave-linge
                min: 0
                max: 100
                needle: true
                severity:
                  green: 0
                  yellow: 30
                  red: 60
              
              - type: gauge
                entity: sensor.four_anomaly_score
                name: Four
                min: 0
                max: 100
                needle: true
                severity:
                  green: 0
                  yellow: 30
                  red: 60
          
          - type: horizontal-stack
            cards:
              - type: gauge
                entity: sensor.lave_vaisselle_anomaly_score
                name: Lave-vaisselle
                min: 0
                max: 100
                needle: true
                severity:
                  green: 0
                  yellow: 30
                  red: 60
              
              - type: gauge
                entity: sensor.seche_linge_anomaly_score
                name: S√®che-linge
                min: 0
                max: 100
                needle: true
                severity:
                  green: 0
                  yellow: 30
                  red: 60
          
          - type: entities
            title: Anomalies D√©tect√©es
            entities:
              - entity: binary_sensor.chauffe_eau_anomaly_detected
                name: "üíß Chauffe-eau"
              - entity: binary_sensor.lave_linge_anomaly_detected
                name: "üß∫ Lave-linge"
              - entity: binary_sensor.four_anomaly_detected
                name: "üçï Four"
              - entity: binary_sensor.lave_vaisselle_anomaly_detected
                name: "üçΩÔ∏è Lave-vaisselle"
              - entity: binary_sensor.seche_linge_anomaly_detected
                name: "üëï S√®che-linge"

      # Graphique des anomaly scores
      - type: custom:apexcharts-card
        header:
          show: true
          title: üìä Historique des Scores d'Anomalie
          show_states: true
        graph_span: 7d
        all_series_config:
          type: line
          stroke_width: 2
        series:
          - entity: sensor.chauffe_eau_anomaly_score
            name: Chauffe-eau
          - entity: sensor.lave_linge_anomaly_score
            name: Lave-linge
          - entity: sensor.four_anomaly_score
            name: Four
          - entity: sensor.lave_vaisselle_anomaly_score
            name: Lave-vaisselle
          - entity: sensor.seche_linge_anomaly_score
            name: S√®che-linge

      # Limites √©nerg√©tiques
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              ### üìä Limites √ânerg√©tiques
          
          - type: entities
            title: D√©passement de Limites
            entities:
              - entity: binary_sensor.chauffe_eau_energy_limit_exceeded
                name: "üíß Chauffe-eau - Limite √©nergie"
              - entity: binary_sensor.lave_linge_energy_limit_exceeded
                name: "üß∫ Lave-linge - Limite √©nergie"
              - entity: binary_sensor.four_energy_limit_exceeded
                name: "üçï Four - Limite √©nergie"
              - entity: binary_sensor.lave_vaisselle_energy_limit_exceeded
                name: "üçΩÔ∏è Lave-vaisselle - Limite √©nergie"
              - entity: binary_sensor.seche_linge_energy_limit_exceeded
                name: "üëï S√®che-linge - Limite √©nergie"
          
          - type: entities
            title: D√©passement de Budget
            entities:
              - entity: binary_sensor.chauffe_eau_budget_exceeded
                name: "üíß Chauffe-eau"
              - entity: binary_sensor.lave_linge_budget_exceeded
                name: "üß∫ Lave-linge"
              - entity: binary_sensor.four_budget_exceeded
                name: "üçï Four"
              - entity: binary_sensor.lave_vaisselle_budget_exceeded
                name: "üçΩÔ∏è Lave-vaisselle"
              - entity: binary_sensor.seche_linge_budget_exceeded
                name: "üëï S√®che-linge"

      # Scheduling
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              ### ‚è∞ Autorisation d'Usage (Scheduling)
          
          - type: entities
            title: Usage Autoris√© Maintenant
            state_color: true
            entities:
              - entity: binary_sensor.chauffe_eau_usage_allowed
                name: "üíß Chauffe-eau"
                secondary_info: last-changed
              - entity: binary_sensor.lave_linge_usage_allowed
                name: "üß∫ Lave-linge"
                secondary_info: last-changed
              - entity: binary_sensor.four_usage_allowed
                name: "üçï Four"
                secondary_info: last-changed
              - entity: binary_sensor.lave_vaisselle_usage_allowed
                name: "üçΩÔ∏è Lave-vaisselle"
                secondary_info: last-changed
              - entity: binary_sensor.seche_linge_usage_allowed
                name: "üëï S√®che-linge"
                secondary_info: last-changed

  # Vue Analyse IA
  - title: Analyse IA
    path: ai-analysis
    icon: mdi:robot
    cards:
      - type: markdown
        content: |
          ## ü§ñ Analyse IA - Smart Appliance Monitor
          
          Configuration actuelle:
          - **AI Task**: `ai_task.google_ai_task`
          - **Trigger**: Manuel
          - **Global Price**: `input_number.edf_price_kwh`

      # Configuration globale
      - type: entities
        title: √âtat des Analyses IA
        state_color: true
        entities:
          - entity: sensor.chauffe_eau_ai_analysis
            name: "üíß Chauffe-eau"
            secondary_info: last-changed
          - entity: sensor.lave_linge_ai_analysis
            name: "üß∫ Lave-linge"
            secondary_info: last-changed
          - entity: sensor.four_ai_analysis
            name: "üçï Four"
            secondary_info: last-changed
          - entity: sensor.lave_vaisselle_ai_analysis
            name: "üçΩÔ∏è Lave-vaisselle"
            secondary_info: last-changed
          - entity: sensor.seche_linge_ai_analysis
            name: "üëï S√®che-linge"
            secondary_info: last-changed
          - entity: sensor.ecran_pc_ai_analysis
            name: "üñ•Ô∏è √âcran PC"
            secondary_info: last-changed
          - entity: sensor.bambulab_x1c_ai_analysis
            name: "üñ®Ô∏è Imprimante 3D"
            secondary_info: last-changed
          - entity: sensor.vmc_ai_analysis
            name: "üí® VMC"
            secondary_info: last-changed
          - entity: sensor.bureau_pc_ai_analysis
            name: "üíª PC Bureau"
            secondary_info: last-changed

      - type: entities
        title: Activer/D√©sactiver l'Analyse IA
        entities:
          - entity: switch.chauffe_eau_ai_analysis
            name: "üíß Chauffe-eau"
          - entity: switch.lave_linge_ai_analysis
            name: "üß∫ Lave-linge"
          - entity: switch.four_ai_analysis
            name: "üçï Four"
          - entity: switch.lave_vaisselle_ai_analysis
            name: "üçΩÔ∏è Lave-vaisselle"
          - entity: switch.seche_linge_ai_analysis
            name: "üëï S√®che-linge"
          - entity: switch.ecran_pc_ai_analysis
            name: "üñ•Ô∏è √âcran PC"
          - entity: switch.bambulab_x1c_ai_analysis
            name: "üñ®Ô∏è Imprimante 3D"
          - entity: switch.vmc_ai_analysis
            name: "üí® VMC"
          - entity: switch.bureau_pc_ai_analysis
            name: "üíª PC Bureau"

      # üíß Chauffe-eau
      - type: horizontal-stack
        cards:
          - type: button
            name: "üíß Pattern"
            icon: mdi:chart-timeline-variant
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.chauffe_eau_state
                analysis_type: pattern
                cycle_count: 10
          
          - type: button
            name: "üíß Comparative"
            icon: mdi:compare
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.chauffe_eau_state
                analysis_type: comparative
                cycle_count: 10
          
          - type: button
            name: "üíß Recommendations"
            icon: mdi:lightbulb-on
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.chauffe_eau_state
                analysis_type: recommendations
                cycle_count: 10
          
          - type: button
            name: "üíß Compl√®te"
            icon: mdi:chart-box
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.chauffe_eau_state
                analysis_type: all
                cycle_count: 10

      # üß∫ Lave-linge
      - type: horizontal-stack
        cards:
          - type: button
            name: "üß∫ Pattern"
            icon: mdi:chart-timeline-variant
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.lave_linge_state
                analysis_type: pattern
                cycle_count: 10
          
          - type: button
            name: "üß∫ Comparative"
            icon: mdi:compare
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.lave_linge_state
                analysis_type: comparative
                cycle_count: 10
          
          - type: button
            name: "üß∫ Recommendations"
            icon: mdi:lightbulb-on
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.lave_linge_state
                analysis_type: recommendations
                cycle_count: 10
          
          - type: button
            name: "üß∫ Compl√®te"
            icon: mdi:chart-box
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.lave_linge_state
                analysis_type: all
                cycle_count: 10

      # üçï Four
      - type: horizontal-stack
        cards:
          - type: button
            name: "üçï Pattern"
            icon: mdi:chart-timeline-variant
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.four_state
                analysis_type: pattern
                cycle_count: 10
          
          - type: button
            name: "üçï Comparative"
            icon: mdi:compare
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.four_state
                analysis_type: comparative
                cycle_count: 10
          
          - type: button
            name: "üçï Recommendations"
            icon: mdi:lightbulb-on
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.four_state
                analysis_type: recommendations
                cycle_count: 10
          
          - type: button
            name: "üçï Compl√®te"
            icon: mdi:chart-box
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.four_state
                analysis_type: all
                cycle_count: 10

      # üçΩÔ∏è Lave-vaisselle
      - type: horizontal-stack
        cards:
          - type: button
            name: "üçΩÔ∏è Pattern"
            icon: mdi:chart-timeline-variant
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.lave_vaisselle_state
                analysis_type: pattern
                cycle_count: 10
          
          - type: button
            name: "üçΩÔ∏è Comparative"
            icon: mdi:compare
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.lave_vaisselle_state
                analysis_type: comparative
                cycle_count: 10
          
          - type: button
            name: "üçΩÔ∏è Recommendations"
            icon: mdi:lightbulb-on
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.lave_vaisselle_state
                analysis_type: recommendations
                cycle_count: 10
          
          - type: button
            name: "üçΩÔ∏è Compl√®te"
            icon: mdi:chart-box
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.lave_vaisselle_state
                analysis_type: all
                cycle_count: 10

      # üëï S√®che-linge
      - type: horizontal-stack
        cards:
          - type: button
            name: "üëï Pattern"
            icon: mdi:chart-timeline-variant
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.seche_linge_state
                analysis_type: pattern
                cycle_count: 10
          
          - type: button
            name: "üëï Comparative"
            icon: mdi:compare
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.seche_linge_state
                analysis_type: comparative
                cycle_count: 10
          
          - type: button
            name: "üëï Recommendations"
            icon: mdi:lightbulb-on
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.seche_linge_state
                analysis_type: recommendations
                cycle_count: 10
          
          - type: button
            name: "üëï Compl√®te"
            icon: mdi:chart-box
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.seche_linge_state
                analysis_type: all
                cycle_count: 10

      # üñ•Ô∏è √âcran PC
      - type: horizontal-stack
        cards:
          - type: button
            name: "üñ•Ô∏è Pattern"
            icon: mdi:chart-timeline-variant
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.ecran_pc_state
                analysis_type: pattern
                cycle_count: 10
          
          - type: button
            name: "üñ•Ô∏è Comparative"
            icon: mdi:compare
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.ecran_pc_state
                analysis_type: comparative
                cycle_count: 10
          
          - type: button
            name: "üñ•Ô∏è Recommendations"
            icon: mdi:lightbulb-on
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.ecran_pc_state
                analysis_type: recommendations
                cycle_count: 10
          
          - type: button
            name: "üñ•Ô∏è Compl√®te"
            icon: mdi:chart-box
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.ecran_pc_state
                analysis_type: all
                cycle_count: 10

      # üñ®Ô∏è Imprimante 3D
      - type: horizontal-stack
        cards:
          - type: button
            name: "üñ®Ô∏è Pattern"
            icon: mdi:chart-timeline-variant
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.bambulab_x1c_state
                analysis_type: pattern
                cycle_count: 10
          
          - type: button
            name: "üñ®Ô∏è Comparative"
            icon: mdi:compare
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.bambulab_x1c_state
                analysis_type: comparative
                cycle_count: 10
          
          - type: button
            name: "üñ®Ô∏è Recommendations"
            icon: mdi:lightbulb-on
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.bambulab_x1c_state
                analysis_type: recommendations
                cycle_count: 10
          
          - type: button
            name: "üñ®Ô∏è Compl√®te"
            icon: mdi:chart-box
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.bambulab_x1c_state
                analysis_type: all
                cycle_count: 10

      # üí® VMC
      - type: horizontal-stack
        cards:
          - type: button
            name: "üí® Pattern"
            icon: mdi:chart-timeline-variant
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.vmc_state
                analysis_type: pattern
                cycle_count: 10
          
          - type: button
            name: "üí® Comparative"
            icon: mdi:compare
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.vmc_state
                analysis_type: comparative
                cycle_count: 10
          
          - type: button
            name: "üí® Recommendations"
            icon: mdi:lightbulb-on
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.vmc_state
                analysis_type: recommendations
                cycle_count: 10
          
          - type: button
            name: "üí® Compl√®te"
            icon: mdi:chart-box
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.vmc_state
                analysis_type: all
                cycle_count: 10

      # üíª PC Bureau
      - type: horizontal-stack
        cards:
          - type: button
            name: "üíª Pattern"
            icon: mdi:chart-timeline-variant
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.bureau_pc_state
                analysis_type: pattern
                cycle_count: 10
          
          - type: button
            name: "üíª Comparative"
            icon: mdi:compare
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.bureau_pc_state
                analysis_type: comparative
                cycle_count: 10
          
          - type: button
            name: "üíª Recommendations"
            icon: mdi:lightbulb-on
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.bureau_pc_state
                analysis_type: recommendations
                cycle_count: 10
          
          - type: button
            name: "üíª Compl√®te"
            icon: mdi:chart-box
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.bureau_pc_state
                analysis_type: all
                cycle_count: 10

      # üíß Chauffe-eau - R√©sultats
      - type: vertical-stack
        cards:
          - type: entities
            title: üíß Chauffe-eau - Analyse IA
            entities:
              - entity: sensor.chauffe_eau_ai_analysis
                name: √âtat
                secondary_info: last-changed
              - type: attribute
                entity: sensor.chauffe_eau_ai_analysis
                attribute: last_analysis_date
                name: Derni√®re analyse
          
          - type: markdown
            content: >
              **R√©sum√©:** {{ state_attr('sensor.chauffe_eau_ai_analysis', 'summary') }}
              
              
              **Recommandations:**
              
              - {{ state_attr('sensor.chauffe_eau_ai_analysis', 'recommendations') | join('\n\n- ') | default('Aucune recommandation disponible', true) }}

          - type: horizontal-stack
            cards:
              - type: custom:mushroom-template-card
                primary: √âconomies (kWh)
                secondary: "{{ state_attr('sensor.chauffe_eau_ai_analysis', 'energy_savings_kwh') }}"
                icon: mdi:lightning-bolt
                icon_color: green
              - type: custom:mushroom-template-card
                primary: √âconomies (‚Ç¨)
                secondary: "{{ state_attr('sensor.chauffe_eau_ai_analysis', 'energy_savings_eur') }} ‚Ç¨"
                icon: mdi:currency-eur
                icon_color: green

      # üß∫ Lave-linge
      - type: vertical-stack
        cards:
          - type: entities
            title: üß∫ Lave-linge - Analyse IA
            entities:
              - entity: sensor.lave_linge_ai_analysis
                name: √âtat
                secondary_info: last-changed
              - type: attribute
                entity: sensor.lave_linge_ai_analysis
                attribute: last_analysis_date
                name: Derni√®re analyse
          
          - type: markdown
            content: >
              **R√©sum√©:** {{ state_attr('sensor.lave_linge_ai_analysis', 'summary') }}
              
              
              **Recommandations:**
              
              - {{ state_attr('sensor.lave_linge_ai_analysis', 'recommendations') | join('\n\n- ') | default('Aucune recommandation disponible', true) }}

          - type: horizontal-stack
            cards:
              - type: custom:mushroom-template-card
                primary: √âconomies (kWh)
                secondary: "{{ state_attr('sensor.lave_linge_ai_analysis', 'energy_savings_kwh') }}"
                icon: mdi:lightning-bolt
                icon_color: green
              - type: custom:mushroom-template-card
                primary: √âconomies (‚Ç¨)
                secondary: "{{ state_attr('sensor.lave_linge_ai_analysis', 'energy_savings_eur') }} ‚Ç¨"
                icon: mdi:currency-eur
                icon_color: green

      # üçï Four
      - type: vertical-stack
        cards:
          - type: entities
            title: üçï Four - Analyse IA
            entities:
              - entity: sensor.four_ai_analysis
                name: √âtat
                secondary_info: last-changed
              - type: attribute
                entity: sensor.four_ai_analysis
                attribute: last_analysis_date
                name: Derni√®re analyse
          
          - type: markdown
            content: >
              **R√©sum√©:** {{ state_attr('sensor.four_ai_analysis', 'summary') }}
              
              
              **Recommandations:**
              
              - {{ state_attr('sensor.four_ai_analysis', 'recommendations') | join('\n\n- ') | default('Aucune recommandation disponible', true) }}

          - type: horizontal-stack
            cards:
              - type: custom:mushroom-template-card
                primary: √âconomies (kWh)
                secondary: "{{ state_attr('sensor.four_ai_analysis', 'energy_savings_kwh') }}"
                icon: mdi:lightning-bolt
                icon_color: green
              - type: custom:mushroom-template-card
                primary: √âconomies (‚Ç¨)
                secondary: "{{ state_attr('sensor.four_ai_analysis', 'energy_savings_eur') }} ‚Ç¨"
                icon: mdi:currency-eur
                icon_color: green

      # üçΩÔ∏è Lave-vaisselle
      - type: vertical-stack
        cards:
          - type: entities
            title: üçΩÔ∏è Lave-vaisselle - Analyse IA
            entities:
              - entity: sensor.lave_vaisselle_ai_analysis
                name: √âtat
                secondary_info: last-changed
              - type: attribute
                entity: sensor.lave_vaisselle_ai_analysis
                attribute: last_analysis_date
                name: Derni√®re analyse
          
          - type: markdown
            content: >
              **R√©sum√©:** {{ state_attr('sensor.lave_vaisselle_ai_analysis', 'summary') }}
              
              
              **Recommandations:**
              
              - {{ state_attr('sensor.lave_vaisselle_ai_analysis', 'recommendations') | join('\n\n- ') | default('Aucune recommandation disponible', true) }}

          - type: horizontal-stack
            cards:
              - type: custom:mushroom-template-card
                primary: √âconomies (kWh)
                secondary: "{{ state_attr('sensor.lave_vaisselle_ai_analysis', 'energy_savings_kwh') }}"
                icon: mdi:lightning-bolt
                icon_color: green
              - type: custom:mushroom-template-card
                primary: √âconomies (‚Ç¨)
                secondary: "{{ state_attr('sensor.lave_vaisselle_ai_analysis', 'energy_savings_eur') }} ‚Ç¨"
                icon: mdi:currency-eur
                icon_color: green

      # üëï S√®che-linge
      - type: vertical-stack
        cards:
          - type: entities
            title: üëï S√®che-linge - Analyse IA
            entities:
              - entity: sensor.seche_linge_ai_analysis
                name: √âtat
                secondary_info: last-changed
              - type: attribute
                entity: sensor.seche_linge_ai_analysis
                attribute: last_analysis_date
                name: Derni√®re analyse
          
          - type: markdown
            content: >
              **R√©sum√©:** {{ state_attr('sensor.seche_linge_ai_analysis', 'summary') }}
              
              
              **Recommandations:**
              
              - {{ state_attr('sensor.seche_linge_ai_analysis', 'recommendations') | join('\n\n- ') | default('Aucune recommandation disponible', true) }}

          - type: horizontal-stack
            cards:
              - type: custom:mushroom-template-card
                primary: √âconomies (kWh)
                secondary: "{{ state_attr('sensor.seche_linge_ai_analysis', 'energy_savings_kwh') }}"
                icon: mdi:lightning-bolt
                icon_color: green
              - type: custom:mushroom-template-card
                primary: √âconomies (‚Ç¨)
                secondary: "{{ state_attr('sensor.seche_linge_ai_analysis', 'energy_savings_eur') }} ‚Ç¨"
                icon: mdi:currency-eur
                icon_color: green

      # üñ•Ô∏è √âcran PC
      - type: vertical-stack
        cards:
          - type: entities
            title: üñ•Ô∏è √âcran PC - Analyse IA
            entities:
              - entity: sensor.ecran_pc_ai_analysis
                name: √âtat
                secondary_info: last-changed
              - type: attribute
                entity: sensor.ecran_pc_ai_analysis
                attribute: last_analysis_date
                name: Derni√®re analyse
          
          - type: markdown
            content: >
              **R√©sum√©:** {{ state_attr('sensor.ecran_pc_ai_analysis', 'summary') }}
              
              
              **Recommandations:**
              
              - {{ state_attr('sensor.ecran_pc_ai_analysis', 'recommendations') | join('\n\n- ') | default('Aucune recommandation disponible', true) }}

          - type: horizontal-stack
            cards:
              - type: custom:mushroom-template-card
                primary: √âconomies (kWh)
                secondary: "{{ state_attr('sensor.ecran_pc_ai_analysis', 'energy_savings_kwh') }}"
                icon: mdi:lightning-bolt
                icon_color: green
              - type: custom:mushroom-template-card
                primary: √âconomies (‚Ç¨)
                secondary: "{{ state_attr('sensor.ecran_pc_ai_analysis', 'energy_savings_eur') }} ‚Ç¨"
                icon: mdi:currency-eur
                icon_color: green

      # üñ®Ô∏è Imprimante 3D
      - type: vertical-stack
        cards:
          - type: entities
            title: üñ®Ô∏è Imprimante 3D - Analyse IA
            entities:
              - entity: sensor.bambulab_x1c_ai_analysis
                name: √âtat
                secondary_info: last-changed
              - type: attribute
                entity: sensor.bambulab_x1c_ai_analysis
                attribute: last_analysis_date
                name: Derni√®re analyse
          
          - type: markdown
            content: >
              **R√©sum√©:** {{ state_attr('sensor.bambulab_x1c_ai_analysis', 'summary') }}
              
              
              **Recommandations:**
              
              - {{ state_attr('sensor.bambulab_x1c_ai_analysis', 'recommendations') | join('\n\n- ') | default('Aucune recommandation disponible', true) }}

          - type: horizontal-stack
            cards:
              - type: custom:mushroom-template-card
                primary: √âconomies (kWh)
                secondary: "{{ state_attr('sensor.bambulab_x1c_ai_analysis', 'energy_savings_kwh') }}"
                icon: mdi:lightning-bolt
                icon_color: green
              - type: custom:mushroom-template-card
                primary: √âconomies (‚Ç¨)
                secondary: "{{ state_attr('sensor.bambulab_x1c_ai_analysis', 'energy_savings_eur') }} ‚Ç¨"
                icon: mdi:currency-eur
                icon_color: green

      # üí® VMC
      - type: vertical-stack
        cards:
          - type: entities
            title: üí® VMC - Analyse IA
            entities:
              - entity: sensor.vmc_ai_analysis
                name: √âtat
                secondary_info: last-changed
              - type: attribute
                entity: sensor.vmc_ai_analysis
                attribute: last_analysis_date
                name: Derni√®re analyse
          
          - type: markdown
            content: >
              **R√©sum√©:** {{ state_attr('sensor.vmc_ai_analysis', 'summary') }}
              
              
              **Recommandations:**
              
              - {{ state_attr('sensor.vmc_ai_analysis', 'recommendations') | join('\n\n- ') | default('Aucune recommandation disponible', true) }}

          - type: horizontal-stack
            cards:
              - type: custom:mushroom-template-card
                primary: √âconomies (kWh)
                secondary: "{{ state_attr('sensor.vmc_ai_analysis', 'energy_savings_kwh') }}"
                icon: mdi:lightning-bolt
                icon_color: green
              - type: custom:mushroom-template-card
                primary: √âconomies (‚Ç¨)
                secondary: "{{ state_attr('sensor.vmc_ai_analysis', 'energy_savings_eur') }} ‚Ç¨"
                icon: mdi:currency-eur
                icon_color: green

      # üíª PC Bureau
      - type: vertical-stack
        cards:
          - type: entities
            title: üíª PC Bureau - Analyse IA
            entities:
              - entity: sensor.bureau_pc_ai_analysis
                name: √âtat
                secondary_info: last-changed
              - type: attribute
                entity: sensor.bureau_pc_ai_analysis
                attribute: last_analysis_date
                name: Derni√®re analyse
          
          - type: markdown
            content: >
              **R√©sum√©:** {{ state_attr('sensor.bureau_pc_ai_analysis', 'summary') }}
              
              
              **Recommandations:**
              
              - {{ state_attr('sensor.bureau_pc_ai_analysis', 'recommendations') | join('\n\n- ') | default('Aucune recommandation disponible', true) }}

          - type: horizontal-stack
            cards:
              - type: custom:mushroom-template-card
                primary: √âconomies (kWh)
                secondary: "{{ state_attr('sensor.bureau_pc_ai_analysis', 'energy_savings_kwh') }}"
                icon: mdi:lightning-bolt
                icon_color: green
              - type: custom:mushroom-template-card
                primary: √âconomies (‚Ç¨)
                secondary: "{{ state_attr('sensor.bureau_pc_ai_analysis', 'energy_savings_eur') }} ‚Ç¨"
                icon: mdi:currency-eur
                icon_color: green

  # Vue Export & Services
  - title: Export & Services
    path: export-services
    icon: mdi:download-box
    cards:
      - type: markdown
        content: |
          ## üì• Export de Donn√©es & Services

      # Export CSV/JSON
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              ### üìä Export de Donn√©es
          
          - type: custom:mushroom-title-card
            title: Export CSV
          
          - type: horizontal-stack
            cards:
              - type: button
                name: Chauffe-eau
                icon: mdi:file-delimited
                tap_action:
                  action: call-service
                  service: smart_appliance_monitor.export_to_csv
                  service_data:
                    entity_id: sensor.chauffe_eau_state
                    file_path: /config/exports/chauffe_eau.csv
              
              - type: button
                name: Lave-linge
                icon: mdi:file-delimited
                tap_action:
                  action: call-service
                  service: smart_appliance_monitor.export_to_csv
                  service_data:
                    entity_id: sensor.lave_linge_state
                    file_path: /config/exports/lave_linge.csv
              
              - type: button
                name: Four
                icon: mdi:file-delimited
                tap_action:
                  action: call-service
                  service: smart_appliance_monitor.export_to_csv
                  service_data:
                    entity_id: sensor.four_state
                    file_path: /config/exports/four.csv
          
          - type: horizontal-stack
            cards:
              - type: button
                name: Lave-vaisselle
                icon: mdi:file-delimited
                tap_action:
                  action: call-service
                  service: smart_appliance_monitor.export_to_csv
                  service_data:
                    entity_id: sensor.lave_vaisselle_state
                    file_path: /config/exports/lave_vaisselle.csv
              
              - type: button
                name: S√®che-linge
                icon: mdi:file-delimited
                tap_action:
                  action: call-service
                  service: smart_appliance_monitor.export_to_csv
                  service_data:
                    entity_id: sensor.seche_linge_state
                    file_path: /config/exports/seche_linge.csv
          
          - type: custom:mushroom-title-card
            title: Export JSON
          
          - type: horizontal-stack
            cards:
              - type: button
                name: Chauffe-eau
                icon: mdi:code-json
                tap_action:
                  action: call-service
                  service: smart_appliance_monitor.export_to_json
                  service_data:
                    entity_id: sensor.chauffe_eau_state
                    file_path: /config/exports/chauffe_eau.json
              
              - type: button
                name: Lave-linge
                icon: mdi:code-json
                tap_action:
                  action: call-service
                  service: smart_appliance_monitor.export_to_json
                  service_data:
                    entity_id: sensor.lave_linge_state
                    file_path: /config/exports/lave_linge.json
              
              - type: button
                name: Four
                icon: mdi:code-json
                tap_action:
                  action: call-service
                  service: smart_appliance_monitor.export_to_json
                  service_data:
                    entity_id: sensor.four_state
                    file_path: /config/exports/four.json
          
          - type: horizontal-stack
            cards:
              - type: button
                name: Lave-vaisselle
                icon: mdi:code-json
                tap_action:
                  action: call-service
                  service: smart_appliance_monitor.export_to_json
                  service_data:
                    entity_id: sensor.lave_vaisselle_state
                    file_path: /config/exports/lave_vaisselle.json
              
              - type: button
                name: S√®che-linge
                icon: mdi:code-json
                tap_action:
                  action: call-service
                  service: smart_appliance_monitor.export_to_json
                  service_data:
                    entity_id: sensor.seche_linge_state
                    file_path: /config/exports/seche_linge.json

      # Reset statistiques
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              ### üîÑ Reset Statistiques
          
          - type: entities
            title: Boutons de Reset
            entities:
              - entity: button.chauffe_eau_reset_stats
                name: "üíß Chauffe-eau"
              - entity: button.lave_linge_reset_stats
                name: "üß∫ Lave-linge"
              - entity: button.four_reset_stats
                name: "üçï Four"
              - entity: button.lave_vaisselle_reset_stats
                name: "üçΩÔ∏è Lave-vaisselle"
              - entity: button.seche_linge_reset_stats
                name: "üëï S√®che-linge"
              - entity: button.ecran_pc_reset_stats
                name: "üñ•Ô∏è √âcran PC"
              - entity: button.bambulab_x1c_reset_stats
                name: "üñ®Ô∏è Imprimante 3D"
              - entity: button.vmc_reset_stats
                name: "üí® VMC"
              - entity: button.bureau_pc_reset_stats
                name: "üíª PC Bureau"

      # Services avanc√©s
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              ### ‚öôÔ∏è Services Avanc√©s
          
          - type: horizontal-stack
            cards:
              - type: button
                name: Sync Energy Dashboard
                icon: mdi:sync
                tap_action:
                  action: call-service
                  service: smart_appliance_monitor.sync_with_energy_dashboard
              
              - type: button
                name: Get Energy Data (Today)
                icon: mdi:database-export
                tap_action:
                  action: call-service
                  service: smart_appliance_monitor.get_energy_data
                  service_data:
                    period: today
              
              - type: button
                name: Get Energy Data (Month)
                icon: mdi:database-export
                tap_action:
                  action: call-service
                  service: smart_appliance_monitor.get_energy_data
                  service_data:
                    period: month

      # Historique des cycles
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              ### üìú Historique des Derniers Cycles
          
          - type: entities
            title: Chauffe-eau - Dernier Cycle
            entities:
              - entity: sensor.chauffe_eau_last_cycle_duration
                name: Dur√©e
              - entity: sensor.chauffe_eau_last_cycle_energy
                name: √ânergie
              - entity: sensor.chauffe_eau_last_cycle_cost
                name: Co√ªt
          
          - type: entities
            title: Lave-linge - Dernier Cycle
            entities:
              - entity: sensor.lave_linge_last_cycle_duration
                name: Dur√©e
              - entity: sensor.lave_linge_last_cycle_energy
                name: √ânergie
              - entity: sensor.lave_linge_last_cycle_cost
                name: Co√ªt
          
          - type: entities
            title: Four - Dernier Cycle
            entities:
              - entity: sensor.four_last_cycle_duration
                name: Dur√©e
              - entity: sensor.four_last_cycle_energy
                name: √ânergie
              - entity: sensor.four_last_cycle_cost
                name: Co√ªt
          
          - type: entities
            title: Lave-vaisselle - Dernier Cycle
            entities:
              - entity: sensor.lave_vaisselle_last_cycle_duration
                name: Dur√©e
              - entity: sensor.lave_vaisselle_last_cycle_energy
                name: √ânergie
              - entity: sensor.lave_vaisselle_last_cycle_cost
                name: Co√ªt
          
          - type: entities
            title: S√®che-linge - Dernier Cycle
            entities:
              - entity: sensor.seche_linge_last_cycle_duration
                name: Dur√©e
              - entity: sensor.seche_linge_last_cycle_energy
                name: √ânergie
              - entity: sensor.seche_linge_last_cycle_cost
                name: Co√ªt

  # Vue Gestion √ânergie Avanc√©e
  - title: Gestion √ânergie
    path: advanced-energy
    icon: mdi:lightning-bolt-circle
    cards:
      - type: markdown
        content: |
          ## ‚ö° Gestion √ânerg√©tique Avanc√©e

      # Energy Management
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              ### üìä Energy Management
          
          - type: entities
            title: Switches Energy Limits
            entities:
              - entity: switch.chauffe_eau_energy_limits
                name: "üíß Chauffe-eau"
              - entity: switch.lave_linge_energy_limits
                name: "üß∫ Lave-linge"
              - entity: switch.four_energy_limits
                name: "üçï Four"
              - entity: switch.lave_vaisselle_energy_limits
                name: "üçΩÔ∏è Lave-vaisselle"
              - entity: switch.seche_linge_energy_limits
                name: "üëï S√®che-linge"
          
          - type: horizontal-stack
            cards:
              - type: gauge
                entity: sensor.chauffe_eau_monthly_energy
                name: Chauffe-eau (Mois)
                min: 0
                max: 100
                unit: kWh
                needle: true
                severity:
                  green: 0
                  yellow: 60
                  red: 80
              
              - type: gauge
                entity: sensor.lave_linge_monthly_energy
                name: Lave-linge (Mois)
                min: 0
                max: 50
                unit: kWh
                needle: true
                severity:
                  green: 0
                  yellow: 30
                  red: 40
              
              - type: gauge
                entity: sensor.four_monthly_energy
                name: Four (Mois)
                min: 0
                max: 30
                unit: kWh
                needle: true
                severity:
                  green: 0
                  yellow: 20
                  red: 25
          
          - type: entities
            title: √ânergie Quotidienne
            entities:
              - entity: sensor.chauffe_eau_daily_energy
                name: "üíß Chauffe-eau"
              - entity: sensor.lave_linge_daily_energy
                name: "üß∫ Lave-linge"
              - entity: sensor.four_daily_energy
                name: "üçï Four"
              - entity: sensor.lave_vaisselle_daily_energy
                name: "üçΩÔ∏è Lave-vaisselle"
              - entity: sensor.seche_linge_daily_energy
                name: "üëï S√®che-linge"
          
          - type: entities
            title: √ânergie Mensuelle
            entities:
              - entity: sensor.chauffe_eau_monthly_energy
                name: "üíß Chauffe-eau"
              - entity: sensor.lave_linge_monthly_energy
                name: "üß∫ Lave-linge"
              - entity: sensor.four_monthly_energy
                name: "üçï Four"
              - entity: sensor.lave_vaisselle_monthly_energy
                name: "üçΩÔ∏è Lave-vaisselle"
              - entity: sensor.seche_linge_monthly_energy
                name: "üëï S√®che-linge"

      # Nombre de cycles quotidiens
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              ### üîÑ Cycles Quotidiens
          
          - type: custom:bar-card
            entities:
              - entity: sensor.chauffe_eau_daily_cycles
                name: Chauffe-eau
                icon: mdi:water-boiler
              - entity: sensor.lave_linge_daily_cycles
                name: Lave-linge
                icon: mdi:washing-machine
              - entity: sensor.four_daily_cycles
                name: Four
                icon: mdi:stove
              - entity: sensor.lave_vaisselle_daily_cycles
                name: Lave-vaisselle
                icon: mdi:dishwasher
              - entity: sensor.seche_linge_daily_cycles
                name: S√®che-linge
                icon: mdi:tumble-dryer
            max: 10
            positions:
              icon: outside
              name: inside
              value: inside

      # Scheduling
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              ### ‚è∞ Scheduling & Horaires
          
          - type: entities
            title: Switches Scheduling
            entities:
              - entity: switch.chauffe_eau_scheduling
                name: "üíß Chauffe-eau"
              - entity: switch.lave_linge_scheduling
                name: "üß∫ Lave-linge"
              - entity: switch.four_scheduling
                name: "üçï Four"
              - entity: switch.lave_vaisselle_scheduling
                name: "üçΩÔ∏è Lave-vaisselle"
              - entity: switch.seche_linge_scheduling
                name: "üëï S√®che-linge"
          
          - type: entities
            title: Plages Horaires Autoris√©es
            entities:
              - entity: binary_sensor.chauffe_eau_usage_allowed
                name: "üíß Chauffe-eau"
                type: custom:multiple-entity-row
                entities:
                  - attribute: allowed_start
                    name: D√©but
                  - attribute: allowed_end
                    name: Fin
              
              - entity: binary_sensor.lave_linge_usage_allowed
                name: "üß∫ Lave-linge"
                type: custom:multiple-entity-row
                entities:
                  - attribute: allowed_start
                    name: D√©but
                  - attribute: allowed_end
                    name: Fin
              
              - entity: binary_sensor.four_usage_allowed
                name: "üçï Four"
                type: custom:multiple-entity-row
                entities:
                  - attribute: allowed_start
                    name: D√©but
                  - attribute: allowed_end
                    name: Fin

      # Auto-Shutdown
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              ### üîå Auto-Shutdown
          
          - type: entities
            title: Switches Auto-Shutdown
            entities:
              - entity: switch.chauffe_eau_auto_shutdown
                name: "üíß Chauffe-eau"
              - entity: switch.lave_linge_auto_shutdown
                name: "üß∫ Lave-linge"
              - entity: switch.four_auto_shutdown
                name: "üçï Four"
              - entity: switch.lave_vaisselle_auto_shutdown
                name: "üçΩÔ∏è Lave-vaisselle"
              - entity: switch.seche_linge_auto_shutdown
                name: "üëï S√®che-linge"

      # Budget et d√©passements
      - type: vertical-stack
        cards:
          - type: markdown
            content: |
              ### üí∞ Budgets & D√©passements
          
          - type: horizontal-stack
            cards:
              - type: gauge
                entity: sensor.chauffe_eau_monthly_cost
                name: Budget Chauffe-eau
                min: 0
                max: 50
                unit: "‚Ç¨"
                needle: true
                severity:
                  green: 0
                  yellow: 35
                  red: 45
              
              - type: gauge
                entity: sensor.lave_linge_monthly_cost
                name: Budget Lave-linge
                min: 0
                max: 20
                unit: "‚Ç¨"
                needle: true
                severity:
                  green: 0
                  yellow: 15
                  red: 18
              
              - type: gauge
                entity: sensor.four_monthly_cost
                name: Budget Four
                min: 0
                max: 15
                unit: "‚Ç¨"
                needle: true
                severity:
                  green: 0
                  yellow: 10
                  red: 13
          
          - type: entities
            title: Alertes de D√©passement
            state_color: true
            entities:
              - entity: binary_sensor.chauffe_eau_energy_limit_exceeded
                name: "üíß Chauffe-eau - Limite √©nergie"
              - entity: binary_sensor.lave_linge_energy_limit_exceeded
                name: "üß∫ Lave-linge - Limite √©nergie"
              - entity: binary_sensor.four_energy_limit_exceeded
                name: "üçï Four - Limite √©nergie"
              - entity: binary_sensor.lave_vaisselle_energy_limit_exceeded
                name: "üçΩÔ∏è Lave-vaisselle - Limite √©nergie"
              - entity: binary_sensor.seche_linge_energy_limit_exceeded
                name: "üëï S√®che-linge - Limite √©nergie"
          
          - type: entities
            title: D√©passement de Budget
            state_color: true
            entities:
              - entity: binary_sensor.chauffe_eau_budget_exceeded
                name: "üíß Chauffe-eau"
              - entity: binary_sensor.lave_linge_budget_exceeded
                name: "üß∫ Lave-linge"
              - entity: binary_sensor.four_budget_exceeded
                name: "üçï Four"
              - entity: binary_sensor.lave_vaisselle_budget_exceeded
                name: "üçΩÔ∏è Lave-vaisselle"
              - entity: binary_sensor.seche_linge_budget_exceeded
                name: "üëï S√®che-linge"

      # Graphique consommation mensuelle
      - type: custom:apexcharts-card
        header:
          show: true
          title: üìä √âvolution Consommation Mensuelle
          show_states: true
        graph_span: 30d
        all_series_config:
          type: line
          stroke_width: 2
          curve: smooth
        series:
          - entity: sensor.chauffe_eau_monthly_energy
            name: Chauffe-eau
          - entity: sensor.lave_linge_monthly_energy
            name: Lave-linge
          - entity: sensor.four_monthly_energy
            name: Four
          - entity: sensor.lave_vaisselle_monthly_energy
            name: Lave-vaisselle
          - entity: sensor.seche_linge_monthly_energy
            name: S√®che-linge

