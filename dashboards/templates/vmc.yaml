# Smart Appliance Monitor - VMC (Ventilation) Dashboard Template
# Version: 0.3.0
# Optimized for VMC with boost mode detection (session-based)

title: {APPLIANCE_NAME}
path: {APPLIANCE_ID}
icon: mdi:fan
type: sections
sections:
  # ============================================
  # SECTION 1: STATUS OVERVIEW
  # ============================================
  - type: grid
    cards:
      - type: custom:mushroom-template-card
        primary: {APPLIANCE_NAME}
        secondary: |
          {% set state = states('sensor.{APPLIANCE_ID}_state') %}
          {% if state == 'running' %}
            üí® Mode Boost - {{ states('sensor.{APPLIANCE_ID}_session_duration') }} min
          {% elif state == 'finished' %}
            ‚úÖ Boost termin√©
          {% else %}
            üí§ Mode normal
          {% endif %}
        icon: mdi:fan
        icon_color: |
          {% set state = states('sensor.{APPLIANCE_ID}_state') %}
          {% if state == 'running' %}
            cyan
          {% elif state == 'finished' %}
            green
          {% else %}
            grey
          {% endif %}
        badge_icon: |
          {% if is_state('binary_sensor.{APPLIANCE_ID}_alert_duration', 'on') %}
            mdi:clock-alert
          {% elif is_state('binary_sensor.{APPLIANCE_ID}_unplugged', 'on') %}
            mdi:power-plug-off
          {% endif %}
        badge_color: |
          {% if is_state('binary_sensor.{APPLIANCE_ID}_alert_duration', 'on') %}
            orange
          {% elif is_state('binary_sensor.{APPLIANCE_ID}_unplugged', 'on') %}
            red
          {% endif %}
        tap_action:
          action: more-info
          entity: sensor.{APPLIANCE_ID}_state
        fill_container: true

  # ============================================
  # SECTION 2: CURRENT BOOST SESSION
  # ============================================
  - title: Session boost en cours
    type: grid
    cards:
      - type: gauge
        entity: sensor.{APPLIANCE_ID}_session_duration
        name: Dur√©e du boost
        needle: true
        severity:
          green: 0
          yellow: 60
          red: 100
        min: 0
        max: 120  # 2h max
        unit: min

      - type: statistic
        entity: sensor.{APPLIANCE_ID}_session_energy
        name: √ânergie (boost)
        icon: mdi:lightning-bolt
        stat_type: mean

      - type: statistic
        entity: sensor.{APPLIANCE_ID}_session_cost
        name: Co√ªt (boost)
        icon: mdi:currency-eur
        stat_type: mean

  # ============================================
  # SECTION 3: VENTILATION MONITORING
  # ============================================
  - title: Surveillance
    type: grid
    cards:
      - type: custom:mini-graph-card
        entities:
          - entity: sensor.{APPLIANCE_ID}_power
            name: Puissance
            color: '#1abc9c'
        name: Consommation (24h) - D√©tection mode boost
        hours_to_show: 24
        points_per_hour: 4
        line_width: 2
        animate: true
        show:
          labels: true
          points: false
          legend: true
          fill: fade
        icon: mdi:air-filter

      # Mode indicator
      - type: custom:mushroom-chips-card
        chips:
          - type: template
            content: |
              {% set power = states('sensor.{APPLIANCE_ID}_power') | float(0) %}
              {% if power > 20 %}
                Mode Boost
              {% elif power > 10 %}
                Mode Normal
              {% else %}
                Arr√™t√©
              {% endif %}
            icon: mdi:fan
            icon_color: |
              {% set power = states('sensor.{APPLIANCE_ID}_power') | float(0) %}
              {% if power > 20 %}
                cyan
              {% elif power > 10 %}
                green
              {% else %}
                grey
              {% endif %}

  # ============================================
  # SECTION 4: CONTROLS
  # ============================================
  - title: Contr√¥les
    type: grid
    cards:
      - type: entities
        entities:
          - entity: switch.{APPLIANCE_ID}_monitoring
            name: Surveillance des boost
            icon: mdi:eye
          - entity: switch.{APPLIANCE_ID}_notifications
            name: Notifications
            icon: mdi:bell
          - type: section
            label: Notifications par type
          - entity: switch.{APPLIANCE_ID}_notification_cycle_started
            name: Boost activ√©
            icon: mdi:fan-plus
          - entity: switch.{APPLIANCE_ID}_notification_cycle_finished
            name: Boost termin√©
            icon: mdi:fan-check
          - entity: switch.{APPLIANCE_ID}_notification_alert_duration
            name: Boost tr√®s long
            icon: mdi:clock-alert
          - entity: switch.{APPLIANCE_ID}_notification_unplugged
            name: VMC arr√™t√©e
            icon: mdi:fan-off
          - type: section
            label: Actions
          - entity: button.{APPLIANCE_ID}_reset_stats
            name: R√©initialiser stats
            icon: mdi:restart

  # ============================================
  # SECTION 5: BOOST STATISTICS
  # ============================================
  - title: Statistiques
    type: grid
    cards:
      # Last Boost Session
      - type: entities
        title: Dernier boost
        icon: mdi:history
        entities:
          - entity: sensor.{APPLIANCE_ID}_last_session_duration
            name: Dur√©e
            icon: mdi:timer
          - entity: sensor.{APPLIANCE_ID}_last_session_energy
            name: √ânergie
            icon: mdi:lightning-bolt
          - entity: sensor.{APPLIANCE_ID}_last_session_cost
            name: Co√ªt
            icon: mdi:currency-eur

      # Daily Boosts
      - type: custom:mushroom-entity-card
        entity: sensor.{APPLIANCE_ID}_daily_sessions
        name: Boost du jour
        icon: mdi:counter
        icon_color: cyan

      # Energy costs
      - type: custom:mushroom-entity-card
        entity: sensor.{APPLIANCE_ID}_daily_cost
        name: Co√ªt quotidien
        icon: mdi:currency-eur
        icon_color: green

      - type: custom:mushroom-entity-card
        entity: sensor.{APPLIANCE_ID}_monthly_cost
        name: Co√ªt mensuel
        icon: mdi:calendar-month
        icon_color: green

  # ============================================
  # SECTION 6: AIR QUALITY IMPACT
  # ============================================
  - title: Impact & Efficacit√©
    type: grid
    cards:
      # Average boost duration
      - type: custom:mushroom-template-card
        primary: |
          {% set sessions = states('sensor.{APPLIANCE_ID}_daily_sessions') | int(0) %}
          {% if sessions > 0 %}
            {{ sessions }} boost{% if sessions > 1 %}s{% endif %} aujourd'hui
          {% else %}
            Aucun boost aujourd'hui
          {% endif %}
        secondary: Fr√©quence d'activation du mode boost
        icon: mdi:counter
        icon_color: purple

      # Energy consumption indicator
      - type: custom:mushroom-template-card
        primary: |
          {% set energy = states('sensor.{APPLIANCE_ID}_last_session_energy') | float(0) %}
          {{ (energy * 1000) | round(0) }} Wh
        secondary: √ânergie par boost (moyenne)
        icon: mdi:lightning-bolt-circle
        icon_color: amber

  # ============================================
  # SECTION 7: SYSTEM STATUS
  # ============================================
  - title: √âtat du syst√®me
    type: grid
    cards:
      # VMC status
      - type: custom:mushroom-template-card
        primary: |
          {% if is_state('binary_sensor.{APPLIANCE_ID}_unplugged', 'off') %}
            ‚úÖ VMC en fonctionnement
          {% else %}
            ‚ö†Ô∏è VMC arr√™t√©e
          {% endif %}
        secondary: |
          {% if is_state('binary_sensor.{APPLIANCE_ID}_unplugged', 'on') %}
            Aucune consommation d√©tect√©e
          {% else %}
            Ventilation active
          {% endif %}
        icon: |
          {% if is_state('binary_sensor.{APPLIANCE_ID}_unplugged', 'off') %}
            mdi:fan
          {% else %}
            mdi:fan-off
          {% endif %}
        icon_color: |
          {% if is_state('binary_sensor.{APPLIANCE_ID}_unplugged', 'off') %}
            green
          {% else %}
            red
          {% endif %}
        tap_action:
          action: more-info
          entity: binary_sensor.{APPLIANCE_ID}_unplugged

      # Current consumption
      - type: custom:mushroom-entity-card
        entity: sensor.{APPLIANCE_ID}_power
        name: Consommation actuelle
        icon: mdi:flash
        icon_color: |
          {% set power = states('sensor.{APPLIANCE_ID}_power') | float(0) %}
          {% if power > 20 %}
            cyan
          {% elif power > 10 %}
            green
          {% elif power > 0 %}
            grey
          {% else %}
            red
          {% endif %}

  # ============================================
  # SECTION 8: ALERTS
  # ============================================
  - title: Alertes
    type: grid
    cards:
      - type: conditional
        conditions:
          - entity: binary_sensor.{APPLIANCE_ID}_unplugged
            state: 'on'
        card:
          type: custom:mushroom-template-card
          primary: ‚ö†Ô∏è VMC arr√™t√©e
          secondary: La ventilation ne fonctionne pas
          icon: mdi:fan-off
          icon_color: red
          tap_action:
            action: more-info
            entity: binary_sensor.{APPLIANCE_ID}_unplugged

      - type: conditional
        conditions:
          - entity: binary_sensor.{APPLIANCE_ID}_alert_duration
            state: 'on'
        card:
          type: custom:mushroom-template-card
          primary: üí® Mode boost prolong√©
          secondary: Le boost est actif depuis longtemps
          icon: mdi:fan-alert
          icon_color: orange
          tap_action:
            action: more-info
            entity: binary_sensor.{APPLIANCE_ID}_alert_duration

