# Smart Appliance Monitor - Washing Machine Dashboard Template
# Version: 1.0.0
# Optimized for washing machines with typical 1-3h cycles

title: {APPLIANCE_NAME}
path: {APPLIANCE_ID}
icon: mdi:washing-machine
type: sections
sections:
  # ============================================
  # SECTION 1: STATUS OVERVIEW
  # ============================================
  - type: grid
    cards:
      # Custom Cycle Card - Modern JS card with real-time updates
      - type: custom:smart-appliance-cycle-card
        entity: sensor.{APPLIANCE_ID}_state
        name: "{APPLIANCE_NAME}"
        icon: "mdi:washing-machine"
        show_power_graph: true
        show_action_buttons: true
        show_current_power: true
        graph_hours: 0.5
        theme: auto

  # ============================================
  # SECTION 2: STATISTICS
  # ============================================
  - title: Statistiques
    type: grid
    cards:
      # Custom Stats Card - Tabbed statistics (Today/Week/Month)
      - type: custom:smart-appliance-stats-card
        entity: sensor.{APPLIANCE_ID}_state
        name: "Statistiques D√©taill√©es"
        default_tab: today
        show_trends: true
        show_efficiency: true
        theme: auto

  # ============================================
  # SECTION 3: CURRENT CYCLE
  # ============================================
  - title: Cycle en Cours
    type: grid
    cards:
      - type: gauge
        entity: sensor.{APPLIANCE_ID}_cycle_duration
        name: Dur√©e Cycle
        needle: true
        severity:
          green: 0
          yellow: 90
          red: 150
        min: 0
        max: 180  # 3h max
        unit: min

      - type: statistic
        entity: sensor.{APPLIANCE_ID}_cycle_energy
        name: √ânergie Consomm√©e
        icon: mdi:lightning-bolt
        stat_type: mean

      - type: statistic
        entity: sensor.{APPLIANCE_ID}_cycle_cost
        name: Co√ªt Cycle
        icon: mdi:currency-eur
        stat_type: mean

  # ============================================
  # SECTION 4: POWER & EFFICIENCY
  # ============================================
  - title: Consommation
    type: grid
    cards:
      - type: custom:mini-graph-card
        entities:
          - entity: sensor.{APPLIANCE_ID}_power
            name: Puissance
            color: '#3498db'
        name: Consommation (24h)
        hours_to_show: 24
        points_per_hour: 4
        line_width: 2
        animate: true
        show:
          labels: true
          points: false
          legend: true
          fill: fade
        icon: mdi:chart-line

      # Average consumption per cycle
      - type: custom:mushroom-entity-card
        entity: sensor.{APPLIANCE_ID}_last_cycle_energy
        name: Consommation Moyenne
        icon: mdi:lightning-bolt-circle
        primary_info: name
        secondary_info: state
        icon_color: amber

  # ============================================
  # SECTION 5: CONTROLS
  # ============================================
  - title: Contr√¥les
    type: grid
    cards:
      - type: entities
        entities:
          - entity: switch.{APPLIANCE_ID}_monitoring
            name: Surveillance Automatique
            icon: mdi:eye
          - entity: switch.{APPLIANCE_ID}_notifications
            name: Notifications
            icon: mdi:bell
          - type: divider
          - type: section
            label: Types de Notifications
          - entity: switch.{APPLIANCE_ID}_notification_cycle_started
            name: Cycle D√©marr√©
            icon: mdi:bell-ring
          - entity: switch.{APPLIANCE_ID}_notification_cycle_finished
            name: Fin du Cycle
            icon: mdi:bell-check
          - entity: switch.{APPLIANCE_ID}_notification_alert_duration
            name: Alerte Dur√©e
            icon: mdi:bell-alert
          - entity: switch.{APPLIANCE_ID}_notification_unplugged
            name: Appareil D√©branch√©
            icon: mdi:bell-off
          - type: divider
          - type: section
            label: Actions
          - entity: button.{APPLIANCE_ID}_reset_stats
            name: R√©initialiser Statistiques
            icon: mdi:restart

  # ============================================
  # SECTION 6: ENERGY MANAGEMENT
  # ============================================
  - title: Gestion √ânerg√©tique
    type: grid
    cards:
      - type: entities
        title: Configuration
        entities:
          - entity: switch.{APPLIANCE_ID}_energy_limits
            name: Limites √ânergie
            icon: mdi:speedometer
          - entity: switch.{APPLIANCE_ID}_auto_shutdown
            name: Arr√™t Automatique
            icon: mdi:power-plug-off

      - type: horizontal-stack
        cards:
          - type: gauge
            entity: sensor.{APPLIANCE_ID}_daily_energy
            name: √ânergie Jour
            min: 0
            max: 5
            unit: kWh
            needle: true
            severity:
              green: 0
              yellow: 3
              red: 4

          - type: gauge
            entity: sensor.{APPLIANCE_ID}_monthly_energy
            name: √ânergie Mois
            min: 0
            max: 50
            unit: kWh
            needle: true
            severity:
              green: 0
              yellow: 30
              red: 40

      - type: entities
        title: Alertes
        entities:
          - entity: binary_sensor.{APPLIANCE_ID}_energy_limit_exceeded
            name: Limite D√©pass√©e
            icon: mdi:alert-circle
          - entity: binary_sensor.{APPLIANCE_ID}_budget_exceeded
            name: Budget D√©pass√©
            icon: mdi:cash-remove

  # ============================================
  # SECTION 7: SCHEDULING
  # ============================================
  - title: Planification
    type: grid
    cards:
      - type: entities
        entities:
          - entity: switch.{APPLIANCE_ID}_scheduling
            name: Activer Planification
            icon: mdi:calendar-clock

      - type: custom:mushroom-template-card
        primary: |
          {% if is_state('binary_sensor.{APPLIANCE_ID}_usage_allowed', 'on') %}
            ‚úÖ Usage Autoris√©
          {% else %}
            ‚õî Usage Non Autoris√©
          {% endif %}
        secondary: |
          {% if is_state('switch.{APPLIANCE_ID}_scheduling', 'on') %}
            Plage: {{ state_attr('binary_sensor.{APPLIANCE_ID}_usage_allowed', 'allowed_start') | default('N/A', true) }} - {{ state_attr('binary_sensor.{APPLIANCE_ID}_usage_allowed', 'allowed_end') | default('N/A', true) }}
          {% else %}
            Planification d√©sactiv√©e
          {% endif %}
        icon: |
          {% if is_state('binary_sensor.{APPLIANCE_ID}_usage_allowed', 'on') %}
            mdi:check-circle
          {% else %}
            mdi:cancel
          {% endif %}
        icon_color: |
          {% if is_state('binary_sensor.{APPLIANCE_ID}_usage_allowed', 'on') %}
            green
          {% else %}
            red
          {% endif %}
        tap_action:
          action: more-info
          entity: binary_sensor.{APPLIANCE_ID}_usage_allowed

  # ============================================
  # SECTION 8: AI ANALYSIS
  # ============================================
  - title: Analyse IA
    type: grid
    cards:
      - type: horizontal-stack
        cards:
          - type: button
            name: Pattern
            icon: mdi:chart-timeline-variant
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.{APPLIANCE_ID}_state
                analysis_type: pattern
                cycle_count: 10

          - type: button
            name: Recommendations
            icon: mdi:lightbulb-on
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.{APPLIANCE_ID}_state
                analysis_type: recommendations
                cycle_count: 10

          - type: button
            name: Compl√®te
            icon: mdi:chart-box
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.{APPLIANCE_ID}_state
                analysis_type: all
                cycle_count: 10

      - type: entities
        title: √âtat Analyse
        entities:
          - entity: switch.{APPLIANCE_ID}_ai_analysis
            name: Activer Analyse IA
          - entity: sensor.{APPLIANCE_ID}_ai_analysis
            name: Derni√®re Analyse
            secondary_info: last-changed

      - type: markdown
        content: >
          **R√©sum√©:** {{ state_attr('sensor.{APPLIANCE_ID}_ai_analysis', 'summary') | default('Aucune analyse disponible', true) }}
          
          
          **Recommandations:**
          
          {{ state_attr('sensor.{APPLIANCE_ID}_ai_analysis', 'recommendations') | default('Aucune recommandation', true) }}

      - type: horizontal-stack
        cards:
          - type: custom:mushroom-template-card
            primary: √âconomies kWh
            secondary: "{{ state_attr('sensor.{APPLIANCE_ID}_ai_analysis', 'energy_savings_kwh') | default('N/A', true) }}"
            icon: mdi:lightning-bolt
            icon_color: green

          - type: custom:mushroom-template-card
            primary: √âconomies ‚Ç¨
            secondary: "{{ state_attr('sensor.{APPLIANCE_ID}_ai_analysis', 'energy_savings_eur') | default('N/A', true) }} ‚Ç¨"
            icon: mdi:currency-eur
            icon_color: green

  # ============================================
  # SECTION 9: ANOMALY DETECTION
  # ============================================
  - title: D√©tection d'Anomalies
    type: grid
    cards:
      - type: gauge
        entity: sensor.{APPLIANCE_ID}_anomaly_score
        name: Score d'Anomalie
        min: 0
        max: 100
        needle: true
        severity:
          green: 0
          yellow: 30
          red: 60

      - type: entities
        entities:
          - entity: binary_sensor.{APPLIANCE_ID}_anomaly_detected
            name: Anomalie D√©tect√©e
            icon: mdi:alert-circle

      - type: custom:mini-graph-card
        entities:
          - entity: sensor.{APPLIANCE_ID}_anomaly_score
            name: Score
            color: '#e74c3c'
        name: Historique Anomalies (7j)
        hours_to_show: 168
        points_per_hour: 1
        line_width: 2
        show:
          labels: true
          points: false
          legend: true
        icon: mdi:chart-line-variant

  # ============================================
  # SECTION 10: ALERTS
  # ============================================
  - title: Alertes
    type: grid
    cards:
      - type: conditional
        conditions:
          - entity: binary_sensor.{APPLIANCE_ID}_alert_duration
            state: 'on'
        card:
          type: custom:mushroom-template-card
          primary: ‚ö†Ô∏è Cycle Anormalement Long
          secondary: Le cycle d√©passe la dur√©e normale
          icon: mdi:alert-circle
          icon_color: red
          tap_action:
            action: more-info
            entity: binary_sensor.{APPLIANCE_ID}_alert_duration

      - type: conditional
        conditions:
          - entity: binary_sensor.{APPLIANCE_ID}_unplugged
            state: 'on'
        card:
          type: custom:mushroom-template-card
          primary: üîå Appareil D√©branch√©
          secondary: Aucune consommation d√©tect√©e
          icon: mdi:power-plug-off
          icon_color: red
          tap_action:
            action: more-info
            entity: binary_sensor.{APPLIANCE_ID}_unplugged

      - type: conditional
        conditions:
          - entity: binary_sensor.{APPLIANCE_ID}_anomaly_detected
            state: 'on'
        card:
          type: custom:mushroom-template-card
          primary: üîç Anomalie D√©tect√©e
          secondary: |
            Score: {{ states('sensor.{APPLIANCE_ID}_anomaly_score') }}
          icon: mdi:alert-circle
          icon_color: orange
          tap_action:
            action: more-info
            entity: binary_sensor.{APPLIANCE_ID}_anomaly_detected

