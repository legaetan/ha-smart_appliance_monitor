# Smart Appliance Monitor - Water Heater Dashboard Template
# Version: 1.0.0
# Optimized for water heaters with heating cycles (typically long cycles)

title: {APPLIANCE_NAME}
path: {APPLIANCE_ID}
icon: mdi:water-boiler
type: sections
sections:
  # ============================================
  # SECTION 1: STATUS OVERVIEW
  # ============================================
  - type: grid
    cards:
      # Custom Cycle Card
      - type: custom:smart-appliance-cycle-card
        entity: sensor.{APPLIANCE_ID}_state
        name: "{APPLIANCE_NAME}"
        icon: "mdi:water-boiler"
        show_power_graph: true
        show_action_buttons: true
        show_current_power: true
        graph_hours: 1
        theme: auto

  # ============================================
  # SECTION 2: STATISTICS
  # ============================================
  - title: Statistiques
    type: grid
    cards:
      - type: custom:smart-appliance-stats-card
        entity: sensor.{APPLIANCE_ID}_state
        name: "Statistiques Détaillées"
        default_tab: today
        show_trends: true
        show_efficiency: true
        theme: auto

  # ============================================
  # SECTION 3: CURRENT CYCLE
  # ============================================
  - title: Cycle de Chauffe
    type: grid
    cards:
      - type: gauge
        entity: sensor.{APPLIANCE_ID}_cycle_duration
        name: Durée Chauffe
        needle: true
        severity:
          green: 0
          yellow: 120
          red: 240
        min: 0
        max: 360  # 6h max
        unit: min

      - type: statistic
        entity: sensor.{APPLIANCE_ID}_cycle_energy
        name: Énergie
        icon: mdi:lightning-bolt
        stat_type: mean

      - type: statistic
        entity: sensor.{APPLIANCE_ID}_cycle_cost
        name: Coût
        icon: mdi:currency-eur
        stat_type: mean

  # ============================================
  # SECTION 4: POWER CONSUMPTION
  # ============================================
  - title: Consommation
    type: grid
    cards:
      - type: custom:mini-graph-card
        entities:
          - entity: sensor.{APPLIANCE_ID}_power
            name: Puissance
            color: '#f39c12'
        name: Consommation (24h)
        hours_to_show: 24
        points_per_hour: 4
        line_width: 2
        animate: true
        show:
          labels: true
          points: false
          legend: true
          fill: fade
        icon: mdi:chart-line

  # Rest of sections follow the same pattern as other templates...
  # CONTROLS, ENERGY MANAGEMENT, SCHEDULING, AI ANALYSIS, ANOMALY DETECTION, ALERTS
  # (Identical structure to washing_machine.yaml)

  - title: Contrôles
    type: grid
    cards:
      - type: entities
        entities:
          - entity: switch.{APPLIANCE_ID}_monitoring
            name: Surveillance
            icon: mdi:eye
          - entity: switch.{APPLIANCE_ID}_notifications
            name: Notifications
            icon: mdi:bell
          - type: divider
          - entity: switch.{APPLIANCE_ID}_notification_cycle_started
            name: Notif. Démarrage
          - entity: switch.{APPLIANCE_ID}_notification_cycle_finished
            name: Notif. Fin
          - entity: switch.{APPLIANCE_ID}_notification_alert_duration
            name: Notif. Durée
          - entity: switch.{APPLIANCE_ID}_notification_unplugged
            name: Notif. Débranché
          - type: divider
          - entity: button.{APPLIANCE_ID}_reset_stats

  - title: Gestion Énergétique
    type: grid
    cards:
      - type: entities
        entities:
          - entity: switch.{APPLIANCE_ID}_energy_limits
            name: Limites Énergie
          - entity: switch.{APPLIANCE_ID}_auto_shutdown
            name: Arrêt Automatique
      - type: horizontal-stack
        cards:
          - type: gauge
            entity: sensor.{APPLIANCE_ID}_daily_energy
            name: Énergie Jour
            min: 0
            max: 15
            unit: kWh
            needle: true
          - type: gauge
            entity: sensor.{APPLIANCE_ID}_monthly_energy
            name: Énergie Mois
            min: 0
            max: 150
            unit: kWh
            needle: true

  - title: Planification
    type: grid
    cards:
      - type: entities
        entities:
          - entity: switch.{APPLIANCE_ID}_scheduling
            name: Activer Planification
      - type: custom:mushroom-template-card
        primary: |
          {% if is_state('binary_sensor.{APPLIANCE_ID}_usage_allowed', 'on') %}
            ✅ Usage Autorisé
          {% else %}
            ⛔ Usage Non Autorisé
          {% endif %}
        icon: mdi:calendar-clock

  - title: Analyse IA
    type: grid
    cards:
      - type: horizontal-stack
        cards:
          - type: button
            name: Analyser
            icon: mdi:chart-box
            tap_action:
              action: call-service
              service: smart_appliance_monitor.analyze_cycles
              service_data:
                entity_id: sensor.{APPLIANCE_ID}_state
                analysis_type: all
                cycle_count: 10
      - type: markdown
        content: >
          {{ state_attr('sensor.{APPLIANCE_ID}_ai_analysis', 'summary') | default('Aucune analyse', true) }}

  - title: Alertes
    type: grid
    cards:
      - type: conditional
        conditions:
          - entity: binary_sensor.{APPLIANCE_ID}_unplugged
            state: 'on'
        card:
          type: custom:mushroom-template-card
          primary: ⚠️ Chauffe-eau Éteint
          icon: mdi:water-boiler-off
          icon_color: red


